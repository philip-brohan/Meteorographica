
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>matplotlib.patches &#8212; Meteorographica: a personal library for weather data</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Meteorographica</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/UK.GS1987.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for matplotlib.patches</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="nb">map</span><span class="p">,</span> <span class="nb">zip</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.cbook</span> <span class="k">as</span> <span class="nn">cbook</span>
<span class="kn">import</span> <span class="nn">matplotlib.artist</span> <span class="k">as</span> <span class="nn">artist</span>
<span class="kn">from</span> <span class="nn">matplotlib.artist</span> <span class="k">import</span> <span class="n">allow_rasterization</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">docstring</span>
<span class="kn">import</span> <span class="nn">matplotlib.transforms</span> <span class="k">as</span> <span class="nn">transforms</span>
<span class="kn">from</span> <span class="nn">matplotlib.path</span> <span class="k">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>

<span class="kn">from</span> <span class="nn">matplotlib.bezier</span> <span class="k">import</span> <span class="n">split_bezier_intersecting_with_closedpath</span>
<span class="kn">from</span> <span class="nn">matplotlib.bezier</span> <span class="k">import</span> <span class="n">get_intersection</span><span class="p">,</span> <span class="n">inside_circle</span><span class="p">,</span> <span class="n">get_parallels</span>
<span class="kn">from</span> <span class="nn">matplotlib.bezier</span> <span class="k">import</span> <span class="n">make_wedged_bezier2</span>
<span class="kn">from</span> <span class="nn">matplotlib.bezier</span> <span class="k">import</span> <span class="n">split_path_inout</span><span class="p">,</span> <span class="n">get_cos_sin</span>
<span class="kn">from</span> <span class="nn">matplotlib.bezier</span> <span class="k">import</span> <span class="n">make_path_regular</span><span class="p">,</span> <span class="n">concatenate_paths</span>


<span class="c1"># these are not available for the object inspector until after the</span>
<span class="c1"># class is built so we define an initial set here for the init</span>
<span class="c1"># function and they will be overridden after object definition</span>
<span class="n">docstring</span><span class="o">.</span><span class="n">interpd</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Patch</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">          =================   ==============================================</span>
<span class="s2">          Property            Description</span>
<span class="s2">          =================   ==============================================</span>
<span class="s2">          alpha               float</span>
<span class="s2">          animated            [True | False]</span>
<span class="s2">          antialiased or aa   [True | False]</span>
<span class="s2">          capstyle            [&#39;butt&#39; | &#39;round&#39; | &#39;projecting&#39;]</span>
<span class="s2">          clip_box            a matplotlib.transform.Bbox instance</span>
<span class="s2">          clip_on             [True | False]</span>
<span class="s2">          edgecolor or ec     any matplotlib color</span>
<span class="s2">          facecolor or fc     any matplotlib color</span>
<span class="s2">          figure              a matplotlib.figure.Figure instance</span>
<span class="s2">          fill                [True | False]</span>
<span class="s2">          hatch               unknown</span>
<span class="s2">          joinstyle           [&#39;miter&#39; | &#39;round&#39; | &#39;bevel&#39;]</span>
<span class="s2">          label               any string</span>
<span class="s2">          linewidth or lw     float</span>
<span class="s2">          lod                 [True | False]</span>
<span class="s2">          transform           a matplotlib.transform transformation instance</span>
<span class="s2">          visible             [True | False]</span>
<span class="s2">          zorder              any number</span>
<span class="s2">          =================   ==============================================</span>

<span class="s2">          &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">_patch_alias_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;antialiased&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;aa&#39;</span><span class="p">],</span>
        <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;ec&#39;</span><span class="p">],</span>
        <span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;fc&#39;</span><span class="p">],</span>
        <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">],</span>
        <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;ls&#39;</span><span class="p">]</span>
    <span class="p">}</span>


<span class="k">class</span> <span class="nc">Patch</span><span class="p">(</span><span class="n">artist</span><span class="o">.</span><span class="n">Artist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A patch is a 2D artist with a face color and an edge color.</span>

<span class="sd">    If any of *edgecolor*, *facecolor*, *linewidth*, or *antialiased*</span>
<span class="sd">    are *None*, they default to their rc params setting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">validCap</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;butt&#39;</span><span class="p">,</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;projecting&#39;</span><span class="p">)</span>
    <span class="n">validJoin</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;miter&#39;</span><span class="p">,</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;bevel&#39;</span><span class="p">)</span>

    <span class="c1"># Whether to draw an edge by default.  Set on a</span>
    <span class="c1"># subclass-by-subclass basis.</span>
    <span class="n">_edge_default</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">facecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">linestyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">antialiased</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">hatch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">capstyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">joinstyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The following kwarg properties are supported</span>

<span class="sd">        %(Patch)s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">artist</span><span class="o">.</span><span class="n">Artist</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;patch.linewidth&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">linestyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;solid&quot;</span>
        <span class="k">if</span> <span class="n">capstyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">capstyle</span> <span class="o">=</span> <span class="s1">&#39;butt&#39;</span>
        <span class="k">if</span> <span class="n">joinstyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">joinstyle</span> <span class="o">=</span> <span class="s1">&#39;miter&#39;</span>
        <span class="k">if</span> <span class="n">antialiased</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">antialiased</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;patch.antialiased&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;hatch.color&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># needed for set_facecolor call</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">edgecolor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">facecolor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Setting the &#39;color&#39; property will override&quot;</span>
                              <span class="s2">&quot;the edgecolor or facecolor properties. &quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">edgecolor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">facecolor</span><span class="p">)</span>
        <span class="c1"># unscaled dashes.  Needed to scale dash patterns by lw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_us_dashes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_fill</span><span class="p">(</span><span class="n">fill</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="n">linestyle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">linewidth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_antialiased</span><span class="p">(</span><span class="n">antialiased</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_capstyle</span><span class="p">(</span><span class="n">capstyle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_joinstyle</span><span class="p">(</span><span class="n">joinstyle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_combined_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">IdentityTransform</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_verts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a copy of the vertices used in this patch</span>

<span class="sd">        If the patch contains Bezier curves, the curves will be</span>
<span class="sd">        interpolated by line segments.  To access the curves as</span>
<span class="sd">        curves, use :meth:`get_path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>
        <span class="n">polygons</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">to_polygons</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygons</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">polygons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_process_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">radius</span>
        <span class="k">if</span> <span class="n">cbook</span><span class="o">.</span><span class="n">is_numlike</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_picker</span><span class="p">):</span>
            <span class="n">_radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_picker</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edgecolor</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_radius</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_linewidth</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_radius</span>

    <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test whether the mouse event occurred in the patch.</span>

<span class="sd">        Returns T/F, {}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_contains</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">)</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_radius</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
        <span class="n">inside</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span><span class="o">.</span><span class="n">contains_point</span><span class="p">(</span>
            <span class="p">(</span><span class="n">mouseevent</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">mouseevent</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(),</span> <span class="n">radius</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inside</span><span class="p">,</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">contains_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns *True* if the given point is inside the path</span>
<span class="sd">        (transformed with its transform attribute).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_radius</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span><span class="o">.</span><span class="n">contains_point</span><span class="p">(</span><span class="n">point</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(),</span>
                                              <span class="n">radius</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates this :class:`Patch` from the properties of *other*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">artist</span><span class="o">.</span><span class="n">Artist</span><span class="o">.</span><span class="n">update_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="c1"># For some properties we don&#39;t need or don&#39;t want to go through the</span>
        <span class="c1"># getters/setters, so we just copy them directly.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_edgecolor</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_edgecolor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_facecolor</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_facecolor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_fill</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_hatch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_color</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_hatch_color</span>
        <span class="c1"># copy the unscaled dash pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_us_dashes</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_us_dashes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_linewidth</span><span class="p">)</span>  <span class="c1"># also sets dash properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_transform</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">get_data_transform</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_extents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a :class:`~matplotlib.transforms.Bbox` object defining</span>
<span class="sd">        the axis-aligned extents of the :class:`Patch`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span><span class="o">.</span><span class="n">get_extents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the :class:`~matplotlib.transforms.Transform` applied</span>
<span class="sd">        to the :class:`Patch`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_patch_transform</span><span class="p">()</span> <span class="o">+</span> <span class="n">artist</span><span class="o">.</span><span class="n">Artist</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_data_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the :class:`~matplotlib.transforms.Transform` instance which</span>
<span class="sd">        maps data coordinates to physical coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">artist</span><span class="o">.</span><span class="n">Artist</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_patch_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the :class:`~matplotlib.transforms.Transform` instance which</span>
<span class="sd">        takes patch coordinates to data coordinates.</span>

<span class="sd">        For example, one may define a patch of a circle which represents a</span>
<span class="sd">        radius of 5 by providing coordinates for a unit circle, and a</span>
<span class="sd">        transform which scales the coordinates (the patch coordinate) by 5.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">transforms</span><span class="o">.</span><span class="n">IdentityTransform</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_antialiased</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if the :class:`Patch` is to be drawn with antialiasing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_antialiased</span>
    <span class="n">get_aa</span> <span class="o">=</span> <span class="n">get_antialiased</span>

    <span class="k">def</span> <span class="nf">get_edgecolor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the edge color of the :class:`Patch`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edgecolor</span>
    <span class="n">get_ec</span> <span class="o">=</span> <span class="n">get_edgecolor</span>

    <span class="k">def</span> <span class="nf">get_facecolor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the face color of the :class:`Patch`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_facecolor</span>
    <span class="n">get_fc</span> <span class="o">=</span> <span class="n">get_facecolor</span>

    <span class="k">def</span> <span class="nf">get_linewidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the line width in points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span>
    <span class="n">get_lw</span> <span class="o">=</span> <span class="n">get_linewidth</span>

    <span class="k">def</span> <span class="nf">get_linestyle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the linestyle.  Will be one of [&#39;solid&#39; | &#39;dashed&#39; |</span>
<span class="sd">        &#39;dashdot&#39; | &#39;dotted&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linestyle</span>
    <span class="n">get_ls</span> <span class="o">=</span> <span class="n">get_linestyle</span>

    <span class="k">def</span> <span class="nf">set_antialiased</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aa</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set whether to use antialiased rendering</span>

<span class="sd">        ACCEPTS: [True | False]  or None for default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">aa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">aa</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;patch.antialiased&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_antialiased</span> <span class="o">=</span> <span class="n">aa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_aa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aa</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;alias for set_antialiased&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_antialiased</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_edgecolor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="n">set_hatch_color</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;patch.force_edgecolor&#39;</span><span class="p">]</span> <span class="ow">or</span>
                    <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_default</span><span class="p">):</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;patch.edgecolor&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
                <span class="n">set_hatch_color</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_edgecolor</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">set_hatch_color</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edgecolor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_edgecolor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the patch edge color</span>

<span class="sd">        ACCEPTS: mpl color spec, None, &#39;none&#39;, or &#39;auto&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_edgecolor</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_edgecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;alias for set_edgecolor&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_facecolor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;patch.facecolor&#39;</span><span class="p">]</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_facecolor</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_facecolor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the patch face color</span>

<span class="sd">        ACCEPTS: mpl color spec, or None for default, or &#39;none&#39; for no color</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_facecolor</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_facecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_fc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;alias for set_facecolor&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set both the edgecolor and the facecolor.</span>

<span class="sd">        ACCEPTS: matplotlib color spec</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            :meth:`set_facecolor`, :meth:`set_edgecolor`</span>
<span class="sd">               For setting the edge or face color individually.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the alpha tranparency of the patch.</span>

<span class="sd">        ACCEPTS: float or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;alpha must be a float or None&#39;</span><span class="p">)</span>
        <span class="n">artist</span><span class="o">.</span><span class="n">Artist</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_facecolor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original_facecolor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_edgecolor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original_edgecolor</span><span class="p">)</span>
        <span class="c1"># stale is already True</span>

    <span class="k">def</span> <span class="nf">set_linewidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the patch linewidth in points</span>

<span class="sd">        ACCEPTS: float or None for default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;patch.linewidth&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.linewidth&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="c1"># scale the dash pattern by the linewidth</span>
        <span class="n">offset</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_us_dashes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dashoffset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dashes</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">_scale_dashes</span><span class="p">(</span>
            <span class="n">offset</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_lw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;alias for set_linewidth&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">lw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_linestyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the patch linestyle</span>

<span class="sd">        ===========================   =================</span>
<span class="sd">        linestyle                     description</span>
<span class="sd">        ===========================   =================</span>
<span class="sd">        ``&#39;-&#39;`` or ``&#39;solid&#39;``        solid line</span>
<span class="sd">        ``&#39;--&#39;`` or  ``&#39;dashed&#39;``     dashed line</span>
<span class="sd">        ``&#39;-.&#39;`` or  ``&#39;dashdot&#39;``    dash-dotted line</span>
<span class="sd">        ``&#39;:&#39;`` or ``&#39;dotted&#39;``       dotted line</span>
<span class="sd">        ===========================   =================</span>

<span class="sd">        Alternatively a dash tuple of the following form can be provided::</span>

<span class="sd">            (offset, onoffseq),</span>

<span class="sd">        where ``onoffseq`` is an even length tuple of on and off ink</span>
<span class="sd">        in points.</span>

<span class="sd">        ACCEPTS: [&#39;solid&#39; | &#39;dashed&#39;, &#39;dashdot&#39;, &#39;dotted&#39; |</span>
<span class="sd">                   (offset, on-off-dash-seq) |</span>
<span class="sd">                   ``&#39;-&#39;`` | ``&#39;--&#39;`` | ``&#39;-.&#39;`` | ``&#39;:&#39;`` | ``&#39;None&#39;`` |</span>
<span class="sd">                   ``&#39; &#39;`` | ``&#39;&#39;``]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ls : { &#39;-&#39;,  &#39;--&#39;, &#39;-.&#39;, &#39;:&#39;} and more see description</span>
<span class="sd">            The line style.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ls</span> <span class="o">=</span> <span class="s2">&quot;solid&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linestyle</span> <span class="o">=</span> <span class="n">ls</span>
        <span class="c1"># get the unscalled dash pattern</span>
        <span class="n">offset</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_us_dashes</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">_get_dash_pattern</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
        <span class="c1"># scale the dash pattern by the linewidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dashoffset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dashes</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">_scale_dashes</span><span class="p">(</span>
            <span class="n">offset</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_ls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;alias for set_linestyle&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_fill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set whether to fill the patch</span>

<span class="sd">        ACCEPTS: [True | False]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_facecolor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original_facecolor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_edgecolor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original_edgecolor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_fill</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;return whether fill is set&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span>

    <span class="c1"># Make fill a property so as to preserve the long-standing</span>
    <span class="c1"># but somewhat inconsistent behavior in which fill was an</span>
    <span class="c1"># attribute.</span>
    <span class="n">fill</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_fill</span><span class="p">,</span> <span class="n">set_fill</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_capstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the patch capstyle</span>

<span class="sd">        ACCEPTS: [&#39;butt&#39; | &#39;round&#39; | &#39;projecting&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validCap</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;set_capstyle passed &quot;</span><span class="si">%s</span><span class="s1">&quot;;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,)</span> <span class="o">+</span>
                             <span class="s1">&#39;valid capstyles are </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validCap</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capstyle</span> <span class="o">=</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_capstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Return the current capstyle&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_capstyle</span>

    <span class="k">def</span> <span class="nf">set_joinstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the patch joinstyle</span>

<span class="sd">        ACCEPTS: [&#39;miter&#39; | &#39;round&#39; | &#39;bevel&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validJoin</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;set_joinstyle passed &quot;</span><span class="si">%s</span><span class="s1">&quot;;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,)</span> <span class="o">+</span>
                             <span class="s1">&#39;valid joinstyles are </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validJoin</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_joinstyle</span> <span class="o">=</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_joinstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Return the current joinstyle&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_joinstyle</span>

    <span class="k">def</span> <span class="nf">set_hatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hatch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the hatching pattern</span>

<span class="sd">        *hatch* can be one of::</span>

<span class="sd">          /   - diagonal hatching</span>
<span class="sd">          \\   - back diagonal</span>
<span class="sd">          |   - vertical</span>
<span class="sd">          -   - horizontal</span>
<span class="sd">          +   - crossed</span>
<span class="sd">          x   - crossed diagonal</span>
<span class="sd">          o   - small circle</span>
<span class="sd">          O   - large circle</span>
<span class="sd">          .   - dots</span>
<span class="sd">          *   - stars</span>

<span class="sd">        Letters can be combined, in which case all the specified</span>
<span class="sd">        hatchings are done.  If same letter repeats, it increases the</span>
<span class="sd">        density of hatching of that pattern.</span>

<span class="sd">        Hatching is supported in the PostScript, PDF, SVG and Agg</span>
<span class="sd">        backends only.</span>

<span class="sd">        ACCEPTS: [&#39;/&#39; | &#39;\\\\&#39; | &#39;|&#39; | &#39;-&#39; | &#39;+&#39; | &#39;x&#39; | &#39;o&#39; | &#39;O&#39; | &#39;.&#39; | &#39;*&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span> <span class="o">=</span> <span class="n">hatch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_hatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Return the current hatching pattern&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span>

    <span class="nd">@allow_rasterization</span>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="s1">&#39;Draw the :class:`Patch` to the given *renderer*.&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_visible</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="n">renderer</span><span class="o">.</span><span class="n">open_group</span><span class="p">(</span><span class="s1">&#39;patch&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_gid</span><span class="p">())</span>
        <span class="n">gc</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">new_gc</span><span class="p">()</span>

        <span class="n">gc</span><span class="o">.</span><span class="n">set_foreground</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_edgecolor</span><span class="p">,</span> <span class="n">isRGBA</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">lw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edgecolor</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lw</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">lw</span><span class="p">)</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">set_dashes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dashes</span><span class="p">)</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">set_capstyle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_capstyle</span><span class="p">)</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">set_joinstyle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_joinstyle</span><span class="p">)</span>

        <span class="n">gc</span><span class="o">.</span><span class="n">set_antialiased</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_antialiased</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_gc_clip</span><span class="p">(</span><span class="n">gc</span><span class="p">)</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">set_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">)</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">set_snap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_snap</span><span class="p">())</span>

        <span class="n">rgbFace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_facecolor</span>
        <span class="k">if</span> <span class="n">rgbFace</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rgbFace</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># (some?) renderers expect this as no-fill signal</span>

        <span class="n">gc</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span><span class="p">:</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">gc</span><span class="o">.</span><span class="n">set_hatch_color</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hatch_color</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># if we end up with a GC that does not have this method</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Your backend does not have support for &quot;</span>
                              <span class="s2">&quot;setting the hatch color.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sketch_params</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">set_sketch_params</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sketch_params</span><span class="p">())</span>

        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span>
        <span class="n">tpath</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform_path_non_affine</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">affine</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">get_affine</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path_effects</span><span class="p">():</span>
            <span class="kn">from</span> <span class="nn">matplotlib.patheffects</span> <span class="k">import</span> <span class="n">PathEffectRenderer</span>
            <span class="n">renderer</span> <span class="o">=</span> <span class="n">PathEffectRenderer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_path_effects</span><span class="p">(),</span> <span class="n">renderer</span><span class="p">)</span>

        <span class="n">renderer</span><span class="o">.</span><span class="n">draw_path</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">tpath</span><span class="p">,</span> <span class="n">affine</span><span class="p">,</span> <span class="n">rgbFace</span><span class="p">)</span>

        <span class="n">gc</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
        <span class="n">renderer</span><span class="o">.</span><span class="n">close_group</span><span class="p">(</span><span class="s1">&#39;patch&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the path of this patch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Derived must override&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_window_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span><span class="o">.</span><span class="n">get_extents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">())</span>


<span class="n">patchdoc</span> <span class="o">=</span> <span class="n">artist</span><span class="o">.</span><span class="n">kwdoc</span><span class="p">(</span><span class="n">Patch</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Rectangle&#39;</span><span class="p">,</span> <span class="s1">&#39;Circle&#39;</span><span class="p">,</span> <span class="s1">&#39;RegularPolygon&#39;</span><span class="p">,</span> <span class="s1">&#39;Polygon&#39;</span><span class="p">,</span> <span class="s1">&#39;Wedge&#39;</span><span class="p">,</span> <span class="s1">&#39;Arrow&#39;</span><span class="p">,</span>
          <span class="s1">&#39;FancyArrow&#39;</span><span class="p">,</span> <span class="s1">&#39;YAArrow&#39;</span><span class="p">,</span> <span class="s1">&#39;CirclePolygon&#39;</span><span class="p">,</span> <span class="s1">&#39;Ellipse&#39;</span><span class="p">,</span> <span class="s1">&#39;Arc&#39;</span><span class="p">,</span>
          <span class="s1">&#39;FancyBboxPatch&#39;</span><span class="p">,</span> <span class="s1">&#39;Patch&#39;</span><span class="p">):</span>
    <span class="n">docstring</span><span class="o">.</span><span class="n">interpd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">patchdoc</span><span class="p">})</span>

<span class="c1"># define Patch.__init__ docstring after the class has been added to interpd</span>
<span class="n">docstring</span><span class="o">.</span><span class="n">dedent_interpd</span><span class="p">(</span><span class="n">Patch</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Shadow</span><span class="p">(</span><span class="n">Patch</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Shadow(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">))</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a shadow of the given *patch* offset by *ox*, *oy*.</span>
<span class="sd">        *props*, if not *None*, is a patch property update dictionary.</span>
<span class="sd">        If *None*, the shadow will have have the same color as the face,</span>
<span class="sd">        but darkened.</span>

<span class="sd">        kwargs are</span>
<span class="sd">        %(Patch)s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Patch</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="n">props</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oy</span> <span class="o">=</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shadow_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">())</span>
            <span class="n">rho</span> <span class="o">=</span> <span class="mf">0.3</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">r</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">g</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">b</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="n">ox</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">points_to_pixels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ox</span><span class="p">)</span>
        <span class="n">oy</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">points_to_pixels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shadow_transform</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_ox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ox</span>

    <span class="k">def</span> <span class="nf">_set_ox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ox</span> <span class="o">=</span> <span class="n">ox</span>

    <span class="k">def</span> <span class="nf">_get_oy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oy</span>

    <span class="k">def</span> <span class="nf">_set_oy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oy</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oy</span> <span class="o">=</span> <span class="n">oy</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_patch_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">get_patch_transform</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shadow_transform</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_transform</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
        <span class="n">Patch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Rectangle</span><span class="p">(</span><span class="n">Patch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw a rectangle with lower left at *xy* = (*x*, *y*) with</span>
<span class="sd">    specified *width*, *height* and rotation *angle*.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;Rectangle(xy=(</span><span class="si">%g</span><span class="s2">, </span><span class="si">%g</span><span class="s2">), width=</span><span class="si">%g</span><span class="s2">, height=</span><span class="si">%g</span><span class="s2">, angle=</span><span class="si">%g</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="n">fmt</span> <span class="o">%</span> <span class="n">pars</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        *angle*</span>
<span class="sd">          rotation in degrees (anti-clockwise)</span>

<span class="sd">        *fill* is a boolean indicating whether to fill the rectangle</span>

<span class="sd">        Valid kwargs are:</span>
<span class="sd">        %(Patch)s</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Patch</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="c1"># Note: This cannot be calculated until this is added to an Axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rect_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">IdentityTransform</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the vertices of the rectangle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Path</span><span class="o">.</span><span class="n">unit_rectangle</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_patch_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;NOTE: This cannot be called until after this has been added</span>
<span class="sd">                 to an Axes, otherwise unit conversion will fail. This</span>
<span class="sd">                 maxes it very important to call the accessor method and</span>
<span class="sd">                 not directly access the transformation member variable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_xunits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_yunits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_xunits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_width</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_yunits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_height</span><span class="p">)</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Bbox</span><span class="o">.</span><span class="n">from_bounds</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">rot_trans</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span>
        <span class="n">rot_trans</span><span class="o">.</span><span class="n">rotate_deg_around</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rect_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">BboxTransformTo</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rect_transform</span> <span class="o">+=</span> <span class="n">rot_trans</span>

    <span class="k">def</span> <span class="nf">get_patch_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_patch_transform</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rect_transform</span>

    <span class="k">def</span> <span class="nf">get_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Return the left coord of the rectangle&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span>

    <span class="k">def</span> <span class="nf">get_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Return the bottom coord of the rectangle&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span>

    <span class="k">def</span> <span class="nf">get_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Return the left and bottom coords of the rectangle&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span>

    <span class="k">def</span> <span class="nf">get_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Return the width of the  rectangle&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span>

    <span class="k">def</span> <span class="nf">get_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Return the height of the rectangle&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_height</span>

    <span class="k">def</span> <span class="nf">set_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the left coord of the rectangle</span>

<span class="sd">        ACCEPTS: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the bottom coord of the rectangle</span>

<span class="sd">        ACCEPTS: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the left and bottom coords of the rectangle</span>

<span class="sd">        ACCEPTS: 2-item sequence</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">xy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the width rectangle</span>

<span class="sd">        ACCEPTS: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the width rectangle</span>

<span class="sd">        ACCEPTS: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_height</span> <span class="o">=</span> <span class="n">h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the bounds of the rectangle: l,b,w,h</span>

<span class="sd">        ACCEPTS: (left, bottom, width, height)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_height</span> <span class="o">=</span> <span class="n">h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Bbox</span><span class="o">.</span><span class="n">from_bounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_height</span><span class="p">)</span>

    <span class="n">xy</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_xy</span><span class="p">,</span> <span class="n">set_xy</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RegularPolygon</span><span class="p">(</span><span class="n">Patch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A regular polygon patch.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Poly</span><span class="si">%d</span><span class="s2">(</span><span class="si">%g</span><span class="s2">,</span><span class="si">%g</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_numVertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">numVertices</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor arguments:</span>

<span class="sd">        *xy*</span>
<span class="sd">          A length 2 tuple (*x*, *y*) of the center.</span>

<span class="sd">        *numVertices*</span>
<span class="sd">          the number of vertices.</span>

<span class="sd">        *radius*</span>
<span class="sd">          The distance from the center to each of the vertices.</span>

<span class="sd">        *orientation*</span>
<span class="sd">          rotates the polygon (in radians).</span>

<span class="sd">        Valid kwargs are:</span>
<span class="sd">        %(Patch)s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xy</span> <span class="o">=</span> <span class="n">xy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_numVertices</span> <span class="o">=</span> <span class="n">numVertices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">orientation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">unit_regular_polygon</span><span class="p">(</span><span class="n">numVertices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_transform</span><span class="p">()</span>

        <span class="n">Patch</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poly_transform</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span> \
            <span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xy</span>

    <span class="k">def</span> <span class="nf">_set_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xy</span> <span class="o">=</span> <span class="n">xy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_transform</span><span class="p">()</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_xy</span><span class="p">,</span> <span class="n">_set_xy</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span>

    <span class="k">def</span> <span class="nf">_set_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orientation</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">orientation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_transform</span><span class="p">()</span>
    <span class="n">orientation</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_orientation</span><span class="p">,</span> <span class="n">_set_orientation</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span>

    <span class="k">def</span> <span class="nf">_set_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_transform</span><span class="p">()</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_radius</span><span class="p">,</span> <span class="n">_set_radius</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_numvertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numVertices</span>

    <span class="k">def</span> <span class="nf">_set_numvertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numVertices</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_numVertices</span> <span class="o">=</span> <span class="n">numVertices</span>

    <span class="n">numvertices</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_numvertices</span><span class="p">,</span> <span class="n">_set_numvertices</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="k">def</span> <span class="nf">get_patch_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_transform</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poly_transform</span>


<span class="k">class</span> <span class="nc">PathPatch</span><span class="p">(</span><span class="n">Patch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A general polycurve path patch.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_edge_default</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Poly((</span><span class="si">%g</span><span class="s2">, </span><span class="si">%g</span><span class="s2">) ...)&quot;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        *path* is a :class:`matplotlib.path.Path` object.</span>

<span class="sd">        Valid kwargs are:</span>
<span class="sd">        %(Patch)s</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            :class:`Patch`</span>
<span class="sd">                For additional kwargs</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Patch</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>


<span class="k">class</span> <span class="nc">Polygon</span><span class="p">(</span><span class="n">Patch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A general polygon patch.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Poly((</span><span class="si">%g</span><span class="s2">, </span><span class="si">%g</span><span class="s2">) ...)&quot;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        *xy* is a numpy array with shape Nx2.</span>

<span class="sd">        If *closed* is *True*, the polygon will be closed so the</span>
<span class="sd">        starting and ending points are the same.</span>

<span class="sd">        Valid kwargs are:</span>
<span class="sd">        %(Patch)s</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            :class:`Patch`</span>
<span class="sd">                For additional kwargs</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Patch</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="n">closed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_xy</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the path of the polygon</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        path : Path</span>
<span class="sd">           The :class:`~matplotlib.path.Path` object for</span>
<span class="sd">           the polygon</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="k">def</span> <span class="nf">get_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns if the polygon is closed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        closed : bool</span>
<span class="sd">            If the path is closed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span>

    <span class="k">def</span> <span class="nf">set_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set if the polygon is closed</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        closed : bool</span>
<span class="sd">           True if the polygon is closed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">(</span><span class="n">closed</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">closed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_xy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_xy</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the vertices of the path</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        vertices : numpy array</span>
<span class="sd">            The coordinates of the vertices as a Nx2</span>
<span class="sd">            ndarray.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">vertices</span>

    <span class="k">def</span> <span class="nf">set_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the vertices of the polygon</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xy : numpy array or iterable of pairs</span>
<span class="sd">            The coordinates of the vertices as a Nx2</span>
<span class="sd">            ndarray or iterable of pairs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">xy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">xy</span><span class="p">,</span> <span class="p">[</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">xy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">xy</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_closed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">_get_xy</span> <span class="o">=</span> <span class="n">get_xy</span>
    <span class="n">_set_xy</span> <span class="o">=</span> <span class="n">set_xy</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="n">get_xy</span><span class="p">,</span> <span class="n">set_xy</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
        <span class="sd">&quot;&quot;&quot;Set/get the vertices of the polygon.  This property is</span>
<span class="sd">           provided for backward compatibility with matplotlib 0.91.x</span>
<span class="sd">           only.  New code should use</span>
<span class="sd">           :meth:`~matplotlib.patches.Polygon.get_xy` and</span>
<span class="sd">           :meth:`~matplotlib.patches.Polygon.set_xy` instead.&quot;&quot;&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Wedge</span><span class="p">(</span><span class="n">Patch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wedge shaped patch.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pars</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">theta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;Wedge(center=(</span><span class="si">%g</span><span class="s2">, </span><span class="si">%g</span><span class="s2">), r=</span><span class="si">%g</span><span class="s2">, theta1=</span><span class="si">%g</span><span class="s2">, theta2=</span><span class="si">%g</span><span class="s2">, width=</span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="n">fmt</span> <span class="o">%</span> <span class="n">pars</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a wedge centered at *x*, *y* center with radius *r* that</span>
<span class="sd">        sweeps *theta1* to *theta2* (in degrees).  If *width* is given,</span>
<span class="sd">        then a partial wedge is drawn from inner radius *r* - *width*</span>
<span class="sd">        to outer radius *r*.</span>

<span class="sd">        Valid kwargs are:</span>

<span class="sd">        %(Patch)s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Patch</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta2</span> <span class="o">=</span> <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">IdentityTransform</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recompute_path</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_recompute_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Inner and outer rings are connected unless the annulus is complete</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">theta2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">360</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1e-12</span><span class="p">:</span>
            <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span>
            <span class="n">connector</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta2</span>
            <span class="n">connector</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span>

        <span class="c1"># Form the outer ring</span>
        <span class="n">arc</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Partial annulus needs to draw the outer ring</span>
            <span class="c1"># followed by a reversed and scaled inner ring</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">arc</span><span class="o">.</span><span class="n">vertices</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">arc</span><span class="o">.</span><span class="n">vertices</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">arc</span><span class="o">.</span><span class="n">codes</span><span class="p">,</span> <span class="n">arc</span><span class="o">.</span><span class="n">codes</span><span class="p">,</span> <span class="n">connector</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">])</span>
            <span class="n">c</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">codes</span><span class="p">)]</span> <span class="o">=</span> <span class="n">connector</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Wedge doesn&#39;t need an inner ring</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">arc</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">arc</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]])</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">arc</span><span class="o">.</span><span class="n">codes</span><span class="p">,</span> <span class="p">[</span><span class="n">connector</span><span class="p">,</span> <span class="n">connector</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]])</span>

        <span class="c1"># Shift and scale the wedge to the final location.</span>
        <span class="n">v</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span>
        <span class="n">v</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_theta1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta1</span> <span class="o">=</span> <span class="n">theta1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_theta2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta2</span> <span class="o">=</span> <span class="n">theta2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recompute_path</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>


<span class="c1"># COVERAGE NOTE: Not used internally or from examples</span>
<span class="k">class</span> <span class="nc">Arrow</span><span class="p">(</span><span class="n">Patch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An arrow patch.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Arrow()&quot;</span>

    <span class="n">_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]],</span>
                 <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws an arrow from (*x*, *y*) to (*x* + *dx*, *y* + *dy*).</span>
<span class="sd">        The width of the arrow is scaled by *width*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : scalar</span>
<span class="sd">            x coordinate of the arrow tail</span>
<span class="sd">        y : scalar</span>
<span class="sd">            y coordinate of the arrow tail</span>
<span class="sd">        dx : scalar</span>
<span class="sd">            Arrow length in the x direction</span>
<span class="sd">        dy : scalar</span>
<span class="sd">            Arrow length in the y direction</span>
<span class="sd">        width : scalar, optional (default: 1)</span>
<span class="sd">            Scale factor for the width of the arrow. With a default value of</span>
<span class="sd">            1, the tail width is 0.2 and head width is 0.6.</span>
<span class="sd">        **kwargs :</span>
<span class="sd">            Keyword arguments control the :class:`~matplotlib.patches.Patch`</span>
<span class="sd">            properties:</span>

<span class="sd">            %(Patch)s</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :class:`FancyArrow` :</span>
<span class="sd">            Patch that allows independent control of the head and tail</span>
<span class="sd">            properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Patch</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">L</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span>
            <span class="n">sx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Account for division by zero</span>
            <span class="n">cx</span><span class="p">,</span> <span class="n">sx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

        <span class="n">trans1</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="n">trans2</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="o">.</span><span class="n">from_values</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="o">-</span><span class="n">sx</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">trans3</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">trans1</span> <span class="o">+</span> <span class="n">trans2</span> <span class="o">+</span> <span class="n">trans3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_transform</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">frozen</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="k">def</span> <span class="nf">get_patch_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_patch_transform</span>


<span class="k">class</span> <span class="nc">FancyArrow</span><span class="p">(</span><span class="n">Polygon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Like Arrow, but lets you set head width and head height independently.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_edge_default</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;FancyArrow()&quot;</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">head_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">head_starts_at_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor arguments</span>
<span class="sd">          *width*: float (default: 0.001)</span>
<span class="sd">            width of full arrow tail</span>

<span class="sd">          *length_includes_head*: [True | False] (default: False)</span>
<span class="sd">            True if head is to be counted in calculating the length.</span>

<span class="sd">          *head_width*: float or None (default: 3*width)</span>
<span class="sd">            total width of the full arrow head</span>

<span class="sd">          *head_length*: float or None (default: 1.5 * head_width)</span>
<span class="sd">            length of arrow head</span>

<span class="sd">          *shape*: [&#39;full&#39;, &#39;left&#39;, &#39;right&#39;] (default: &#39;full&#39;)</span>
<span class="sd">            draw the left-half, right-half, or full arrow</span>

<span class="sd">          *overhang*: float (default: 0)</span>
<span class="sd">            fraction that the arrow is swept back (0 overhang means</span>
<span class="sd">            triangular shape). Can be negative or greater than one.</span>

<span class="sd">          *head_starts_at_zero*: [True | False] (default: False)</span>
<span class="sd">            if True, the head starts being drawn at coordinate 0</span>
<span class="sd">            instead of ending at coordinate 0.</span>

<span class="sd">        Other valid kwargs (inherited from :class:`Patch`) are:</span>
<span class="sd">        %(Patch)s</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">head_width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">head_width</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">width</span>
        <span class="k">if</span> <span class="n">head_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">head_length</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">head_width</span>

        <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">length_includes_head</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">distance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">+</span> <span class="n">head_length</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">length</span><span class="p">:</span>
            <span class="n">verts</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># display nothing if empty</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># start by drawing horizontal arrow, point at (0,0)</span>
            <span class="n">hw</span><span class="p">,</span> <span class="n">hl</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">head_width</span><span class="p">,</span> <span class="n">head_length</span><span class="p">,</span> <span class="n">overhang</span><span class="p">,</span> <span class="n">width</span>
            <span class="n">left_half_arrow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>                  <span class="c1"># tip</span>
                <span class="p">[</span><span class="o">-</span><span class="n">hl</span><span class="p">,</span> <span class="o">-</span><span class="n">hw</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>             <span class="c1"># leftmost</span>
                <span class="p">[</span><span class="o">-</span><span class="n">hl</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">hs</span><span class="p">),</span> <span class="o">-</span><span class="n">lw</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>  <span class="c1"># meets stem</span>
                <span class="p">[</span><span class="o">-</span><span class="n">length</span><span class="p">,</span> <span class="o">-</span><span class="n">lw</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>          <span class="c1"># bottom left</span>
                <span class="p">[</span><span class="o">-</span><span class="n">length</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">])</span>
            <span class="c1"># if we&#39;re not including the head, shift up by head length</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">length_includes_head</span><span class="p">:</span>
                <span class="n">left_half_arrow</span> <span class="o">+=</span> <span class="p">[</span><span class="n">head_length</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="c1"># if the head starts at 0, shift up by another head length</span>
            <span class="k">if</span> <span class="n">head_starts_at_zero</span><span class="p">:</span>
                <span class="n">left_half_arrow</span> <span class="o">+=</span> <span class="p">[</span><span class="n">head_length</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="c1"># figure out the shape, and complete accordingly</span>
            <span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
                <span class="n">coords</span> <span class="o">=</span> <span class="n">left_half_arrow</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">right_half_arrow</span> <span class="o">=</span> <span class="n">left_half_arrow</span> <span class="o">*</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
                    <span class="n">coords</span> <span class="o">=</span> <span class="n">right_half_arrow</span>
                <span class="k">elif</span> <span class="n">shape</span> <span class="o">==</span> <span class="s1">&#39;full&#39;</span><span class="p">:</span>
                    <span class="c1"># The half-arrows contain the midpoint of the stem,</span>
                    <span class="c1"># which we can omit from the full arrow. Including it</span>
                    <span class="c1"># twice caused a problem with xpdf.</span>
                    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">left_half_arrow</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="n">right_half_arrow</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Got unknown shape: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">distance</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="o">/</span> <span class="n">distance</span>
                <span class="n">sx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span> <span class="o">/</span> <span class="n">distance</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#Account for division by zero</span>
                <span class="n">cx</span><span class="p">,</span> <span class="n">sx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">cx</span><span class="p">,</span> <span class="n">sx</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">sx</span><span class="p">,</span> <span class="n">cx</span><span class="p">]])</span>
            <span class="n">verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)</span>

        <span class="n">Polygon</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">verts</span><span class="p">)),</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="n">docstring</span><span class="o">.</span><span class="n">interpd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;FancyArrow&quot;</span><span class="p">:</span> <span class="n">FancyArrow</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">})</span>


<span class="k">class</span> <span class="nc">YAArrow</span><span class="p">(</span><span class="n">Patch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Yet another arrow class.</span>

<span class="sd">    This is an arrow that is defined in display space and has a tip at</span>
<span class="sd">    *x1*, *y1* and a base at *x2*, *y2*.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;YAArrow()&quot;</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure</span><span class="p">,</span> <span class="n">xytip</span><span class="p">,</span> <span class="n">xybase</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor arguments:</span>

<span class="sd">        *xytip*</span>
<span class="sd">          (*x*, *y*) location of arrow tip</span>

<span class="sd">        *xybase*</span>
<span class="sd">          (*x*, *y*) location the arrow base mid point</span>

<span class="sd">        *figure*</span>
<span class="sd">          The :class:`~matplotlib.figure.Figure` instance</span>
<span class="sd">          (fig.dpi)</span>

<span class="sd">        *width*</span>
<span class="sd">          The width of the arrow in points</span>

<span class="sd">        *frac*</span>
<span class="sd">          The fraction of the arrow length occupied by the head</span>

<span class="sd">        *headwidth*</span>
<span class="sd">          The width of the base of the arrow head in points</span>

<span class="sd">        Valid kwargs are:</span>
<span class="sd">        %(Patch)s</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xytip</span> <span class="o">=</span> <span class="n">xytip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xybase</span> <span class="o">=</span> <span class="n">xybase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frac</span> <span class="o">=</span> <span class="n">frac</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headwidth</span> <span class="o">=</span> <span class="n">headwidth</span>
        <span class="n">Patch</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Set self.figure after Patch.__init__, since it sets self.figure to</span>
        <span class="c1"># None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">figure</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Since this is dpi dependent, we need to recompute the path</span>
        <span class="c1"># every time.</span>

        <span class="c1"># the base vertices</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xytip</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xybase</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span> <span class="o">/</span> <span class="mf">72.</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headwidth</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span> <span class="o">/</span> <span class="mf">72.</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">xb1</span><span class="p">,</span> <span class="n">yb1</span><span class="p">,</span> <span class="n">xb2</span><span class="p">,</span> <span class="n">yb2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getpoints</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">k1</span><span class="p">)</span>

        <span class="c1"># a point on the segment 20% of the distance from the tip to the base</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">+</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="n">xm</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frac</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">ym</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frac</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">xc1</span><span class="p">,</span> <span class="n">yc1</span><span class="p">,</span> <span class="n">xc2</span><span class="p">,</span> <span class="n">yc2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getpoints</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">k1</span><span class="p">)</span>
        <span class="n">xd1</span><span class="p">,</span> <span class="n">yd1</span><span class="p">,</span> <span class="n">xd2</span><span class="p">,</span> <span class="n">yd2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getpoints</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>

        <span class="n">xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_xunits</span><span class="p">([</span><span class="n">xb1</span><span class="p">,</span> <span class="n">xb2</span><span class="p">,</span> <span class="n">xc2</span><span class="p">,</span> <span class="n">xd2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">xd1</span><span class="p">,</span> <span class="n">xc1</span><span class="p">,</span> <span class="n">xb1</span><span class="p">])</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_yunits</span><span class="p">([</span><span class="n">yb1</span><span class="p">,</span> <span class="n">yb2</span><span class="p">,</span> <span class="n">yc2</span><span class="p">,</span> <span class="n">yd2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">yd1</span><span class="p">,</span> <span class="n">yc1</span><span class="p">,</span> <span class="n">yb1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)),</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_patch_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">transforms</span><span class="o">.</span><span class="n">IdentityTransform</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For line segment defined by (*x1*, *y1*) and (*x2*, *y2*)</span>
<span class="sd">        return the points on the line that is perpendicular to the</span>
<span class="sd">        line and intersects (*x2*, *y2*) and the distance from (*x2*,</span>
<span class="sd">        *y2*) of the returned points is *k*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">k</span>
        <span class="k">elif</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="n">y2</span>

        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
        <span class="n">pm</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">m</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">y2</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">-</span> <span class="n">k</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">pm</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">pm</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">)</span>

        <span class="n">y3a</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">x3a</span> <span class="o">=</span> <span class="p">(</span><span class="n">y3a</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">/</span> <span class="n">pm</span> <span class="o">+</span> <span class="n">x2</span>

        <span class="n">y3b</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">x3b</span> <span class="o">=</span> <span class="p">(</span><span class="n">y3b</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">/</span> <span class="n">pm</span> <span class="o">+</span> <span class="n">x2</span>
        <span class="k">return</span> <span class="n">x3a</span><span class="p">,</span> <span class="n">y3a</span><span class="p">,</span> <span class="n">x3b</span><span class="p">,</span> <span class="n">y3b</span>


<span class="k">class</span> <span class="nc">CirclePolygon</span><span class="p">(</span><span class="n">RegularPolygon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A polygon-approximation of a circle patch.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;CirclePolygon(</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                 <span class="n">resolution</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>  <span class="c1"># the number of vertices</span>
                 <span class="o">**</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a circle at *xy* = (*x*, *y*) with given *radius*.</span>
<span class="sd">        This circle is approximated by a regular polygon with</span>
<span class="sd">        *resolution* sides.  For a smoother circle drawn with splines,</span>
<span class="sd">        see :class:`~matplotlib.patches.Circle`.</span>

<span class="sd">        Valid kwargs are:</span>
<span class="sd">        %(Patch)s</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">RegularPolygon</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span>
                                <span class="n">resolution</span><span class="p">,</span>
                                <span class="n">radius</span><span class="p">,</span>
                                <span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Ellipse</span><span class="p">(</span><span class="n">Patch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A scale-free ellipse.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pars</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;Ellipse(xy=(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">), width=</span><span class="si">%s</span><span class="s2">, height=</span><span class="si">%s</span><span class="s2">, angle=</span><span class="si">%s</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="n">fmt</span> <span class="o">%</span> <span class="n">pars</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        *xy*</span>
<span class="sd">          center of ellipse</span>

<span class="sd">        *width*</span>
<span class="sd">          total length (diameter) of horizontal axis</span>

<span class="sd">        *height*</span>
<span class="sd">          total length (diameter) of vertical axis</span>

<span class="sd">        *angle*</span>
<span class="sd">          rotation in degrees (anti-clockwise)</span>

<span class="sd">        Valid kwargs are:</span>
<span class="sd">        %(Patch)s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Patch</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">xy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">unit_circle</span><span class="p">()</span>
        <span class="c1"># Note: This cannot be calculated until this is added to an Axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">IdentityTransform</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_recompute_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;NOTE: This cannot be called until after this has been added</span>
<span class="sd">                 to an Axes, otherwise unit conversion will fail. This</span>
<span class="sd">                 maxes it very important to call the accessor method and</span>
<span class="sd">                 not directly access the transformation member variable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_xunits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">convert_yunits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_xunits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_yunits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span> \
            <span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">height</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">rotate_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">*</span><span class="n">center</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the vertices of the rectangle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="k">def</span> <span class="nf">get_patch_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recompute_transform</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_patch_transform</span>


<div class="viewcode-block" id="Circle"><a class="viewcode-back" href="../../weathermap.html#Meteorographica.weathermap.Circle">[docs]</a><span class="k">class</span> <span class="nc">Circle</span><span class="p">(</span><span class="n">Ellipse</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A circle patch.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;Circle(xy=(</span><span class="si">%g</span><span class="s2">, </span><span class="si">%g</span><span class="s2">), radius=</span><span class="si">%g</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="n">fmt</span> <span class="o">%</span> <span class="n">pars</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create true circle at center *xy* = (*x*, *y*) with given</span>
<span class="sd">        *radius*.  Unlike :class:`~matplotlib.patches.CirclePolygon`</span>
<span class="sd">        which is a polygonal approximation, this uses Bézier splines</span>
<span class="sd">        and is much closer to a scale-free circle.</span>

<span class="sd">        Valid kwargs are:</span>
<span class="sd">        %(Patch)s</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Ellipse</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>

<div class="viewcode-block" id="Circle.set_radius"><a class="viewcode-back" href="../../weathermap.html#Meteorographica.weathermap.Circle.set_radius">[docs]</a>    <span class="k">def</span> <span class="nf">set_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the radius of the circle</span>

<span class="sd">        ACCEPTS: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Circle.get_radius"><a class="viewcode-back" href="../../weathermap.html#Meteorographica.weathermap.Circle.get_radius">[docs]</a>    <span class="k">def</span> <span class="nf">get_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;return the radius of the circle&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mf">2.</span></div>

    <span class="n">radius</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_radius</span><span class="p">,</span> <span class="n">set_radius</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">Arc</span><span class="p">(</span><span class="n">Ellipse</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An elliptical arc.  Because it performs various optimizations, it</span>
<span class="sd">    can not be filled.</span>

<span class="sd">    The arc must be used in an :class:`~matplotlib.axes.Axes`</span>
<span class="sd">    instance---it can not be added directly to a</span>
<span class="sd">    :class:`~matplotlib.figure.Figure`---because it is optimized to</span>
<span class="sd">    only render the segments that are inside the axes bounding box</span>
<span class="sd">    with high resolution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pars</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta2</span><span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Arc(xy=(</span><span class="si">%g</span><span class="s2">, </span><span class="si">%g</span><span class="s2">), width=</span><span class="si">%g</span><span class="s2">, &quot;</span>
               <span class="s2">&quot;height=</span><span class="si">%g</span><span class="s2">, angle=</span><span class="si">%g</span><span class="s2">, theta1=</span><span class="si">%g</span><span class="s2">, theta2=</span><span class="si">%g</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fmt</span> <span class="o">%</span> <span class="n">pars</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">theta1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">theta2</span><span class="o">=</span><span class="mf">360.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The following args are supported:</span>

<span class="sd">        *xy*</span>
<span class="sd">          center of ellipse</span>

<span class="sd">        *width*</span>
<span class="sd">          length of horizontal axis</span>

<span class="sd">        *height*</span>
<span class="sd">          length of vertical axis</span>

<span class="sd">        *angle*</span>
<span class="sd">          rotation in degrees (anti-clockwise)</span>

<span class="sd">        *theta1*</span>
<span class="sd">          starting angle of the arc in degrees</span>

<span class="sd">        *theta2*</span>
<span class="sd">          ending angle of the arc in degrees</span>

<span class="sd">        If *theta1* and *theta2* are not provided, the arc will form a</span>
<span class="sd">        complete ellipse.</span>

<span class="sd">        Valid kwargs are:</span>

<span class="sd">        %(Patch)s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fill</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Arc objects can not be filled&quot;</span><span class="p">)</span>

        <span class="n">Ellipse</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">theta1</span> <span class="o">=</span> <span class="n">theta1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta2</span> <span class="o">=</span> <span class="n">theta2</span>

    <span class="nd">@allow_rasterization</span>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ellipses are normally drawn using an approximation that uses</span>
<span class="sd">        eight cubic bezier splines.  The error of this approximation</span>
<span class="sd">        is 1.89818e-6, according to this unverified source:</span>

<span class="sd">          Lancaster, Don.  Approximating a Circle or an Ellipse Using</span>
<span class="sd">          Four Bezier Cubic Splines.</span>

<span class="sd">          http://www.tinaja.com/glib/ellipse4.pdf</span>

<span class="sd">        There is a use case where very large ellipses must be drawn</span>
<span class="sd">        with very high accuracy, and it is too expensive to render the</span>
<span class="sd">        entire ellipse with enough segments (either splines or line</span>
<span class="sd">        segments).  Therefore, in the case where either radius of the</span>
<span class="sd">        ellipse is large enough that the error of the spline</span>
<span class="sd">        approximation will be visible (greater than one pixel offset</span>
<span class="sd">        from the ideal), a different technique is used.</span>

<span class="sd">        In that case, only the visible parts of the ellipse are drawn,</span>
<span class="sd">        with each visible arc using a fixed number of spline segments</span>
<span class="sd">        (8).  The algorithm proceeds as follows:</span>

<span class="sd">          1. The points where the ellipse intersects the axes bounding</span>
<span class="sd">             box are located.  (This is done be performing an inverse</span>
<span class="sd">             transformation on the axes bbox such that it is relative</span>
<span class="sd">             to the unit circle -- this makes the intersection</span>
<span class="sd">             calculation much easier than doing rotated ellipse</span>
<span class="sd">             intersection directly).</span>

<span class="sd">             This uses the &quot;line intersecting a circle&quot; algorithm</span>
<span class="sd">             from:</span>

<span class="sd">               Vince, John.  Geometry for Computer Graphics: Formulae,</span>
<span class="sd">               Examples &amp; Proofs.  London: Springer-Verlag, 2005.</span>

<span class="sd">          2. The angles of each of the intersection points are</span>
<span class="sd">             calculated.</span>

<span class="sd">          3. Proceeding counterclockwise starting in the positive</span>
<span class="sd">             x-direction, each of the visible arc-segments between the</span>
<span class="sd">             pairs of vertices are drawn using the bezier arc</span>
<span class="sd">             approximation technique implemented in</span>
<span class="sd">             :meth:`matplotlib.path.Path.arc`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;axes&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Arcs can only be used in Axes instances&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_recompute_transform</span><span class="p">()</span>

        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_xunits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_yunits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

        <span class="c1"># If the width and height of ellipse are not equal, take into account</span>
        <span class="c1"># stretching when calculating angles to draw between</span>
        <span class="k">def</span> <span class="nf">theta_stretch</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">theta1</span> <span class="o">=</span> <span class="n">theta_stretch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta1</span><span class="p">,</span> <span class="n">width</span> <span class="o">/</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">theta2</span> <span class="o">=</span> <span class="n">theta_stretch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta2</span><span class="p">,</span> <span class="n">width</span> <span class="o">/</span> <span class="n">height</span><span class="p">)</span>

        <span class="c1"># Get width and height in pixels</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span><span class="o">.</span><span class="n">transform_point</span><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
        <span class="n">inv_error</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">1.89818e-6</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;</span> <span class="n">inv_error</span> <span class="ow">and</span> <span class="n">height</span> <span class="o">&lt;</span> <span class="n">inv_error</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Patch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">iter_circle_intersect_on_line</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">):</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span>
            <span class="n">dr2</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span>
            <span class="n">D</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">*</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">y0</span>
            <span class="n">D2</span> <span class="o">=</span> <span class="n">D</span> <span class="o">*</span> <span class="n">D</span>
            <span class="n">discrim</span> <span class="o">=</span> <span class="n">dr2</span> <span class="o">-</span> <span class="n">D2</span>

            <span class="c1"># Single (tangential) intersection</span>
            <span class="k">if</span> <span class="n">discrim</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">D</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span> <span class="o">/</span> <span class="n">dr2</span>
                <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">D</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span> <span class="o">/</span> <span class="n">dr2</span>
                <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
            <span class="k">elif</span> <span class="n">discrim</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="c1"># The definition of &quot;sign&quot; here is different from</span>
                <span class="c1"># np.sign: we never want to get 0.0</span>
                <span class="k">if</span> <span class="n">dy</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">sign_dy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sign_dy</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="n">sqrt_discrim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">discrim</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">sign</span> <span class="ow">in</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">D</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">sign_dy</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">sqrt_discrim</span><span class="p">)</span> <span class="o">/</span> <span class="n">dr2</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">D</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span> <span class="o">*</span> <span class="n">sqrt_discrim</span><span class="p">)</span> <span class="o">/</span> <span class="n">dr2</span>
                    <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

        <span class="k">def</span> <span class="nf">iter_circle_intersect_on_line_seg</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">):</span>
            <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-9</span>
            <span class="k">if</span> <span class="n">x1</span> <span class="o">&lt;</span> <span class="n">x0</span><span class="p">:</span>
                <span class="n">x0e</span><span class="p">,</span> <span class="n">x1e</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x0e</span><span class="p">,</span> <span class="n">x1e</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span>
            <span class="k">if</span> <span class="n">y1</span> <span class="o">&lt;</span> <span class="n">y0</span><span class="p">:</span>
                <span class="n">y0e</span><span class="p">,</span> <span class="n">y1e</span> <span class="o">=</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y0e</span><span class="p">,</span> <span class="n">y1e</span> <span class="o">=</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span>
            <span class="n">x0e</span> <span class="o">-=</span> <span class="n">epsilon</span>
            <span class="n">y0e</span> <span class="o">-=</span> <span class="n">epsilon</span>
            <span class="n">x1e</span> <span class="o">+=</span> <span class="n">epsilon</span>
            <span class="n">y1e</span> <span class="o">+=</span> <span class="n">epsilon</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">iter_circle_intersect_on_line</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">x0e</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">x1e</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="n">y0e</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">y1e</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

        <span class="c1"># Transforms the axes box_path so that it is relative to the unit</span>
        <span class="c1"># circle in the same way that it is relative to the desired</span>
        <span class="c1"># ellipse.</span>
        <span class="n">box_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">unit_rectangle</span><span class="p">()</span>
        <span class="n">box_path_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">BboxTransformTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span>
        <span class="n">box_path</span> <span class="o">=</span> <span class="n">box_path</span><span class="o">.</span><span class="n">transformed</span><span class="p">(</span><span class="n">box_path_transform</span><span class="p">)</span>

        <span class="n">thetas</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1"># For each of the point pairs, there is a line segment</span>
        <span class="k">for</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">box_path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">box_path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">p1</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">iter_circle_intersect_on_line_seg</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">):</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">theta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">theta</span>
                <span class="c1"># Convert radians to angles</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">theta1</span> <span class="o">&lt;</span> <span class="n">theta</span> <span class="o">&lt;</span> <span class="n">theta2</span><span class="p">:</span>
                    <span class="n">thetas</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">thetas</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">thetas</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">theta2</span><span class="p">]</span>

        <span class="n">last_theta</span> <span class="o">=</span> <span class="n">theta1</span>
        <span class="n">theta1_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span>
        <span class="n">inside</span> <span class="o">=</span> <span class="n">box_path</span><span class="o">.</span><span class="n">contains_point</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1_rad</span><span class="p">),</span>
                                          <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta1_rad</span><span class="p">)))</span>

        <span class="c1"># save original path</span>
        <span class="n">path_original</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>
        <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">thetas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inside</span><span class="p">:</span>
                <span class="n">Path</span><span class="o">.</span><span class="n">arc</span><span class="p">(</span><span class="n">last_theta</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
                <span class="n">Patch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
                <span class="n">inside</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inside</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">last_theta</span> <span class="o">=</span> <span class="n">theta</span>

        <span class="c1"># restore original path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path_original</span>


<span class="k">def</span> <span class="nf">bbox_artist</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a debug function to draw a rectangle around the bounding</span>
<span class="sd">    box returned by</span>
<span class="sd">    :meth:`~matplotlib.artist.Artist.get_window_extent` of an artist,</span>
<span class="sd">    to test whether the artist is returning the correct bbox.</span>

<span class="sd">    *props* is a dict of rectangle props with the additional property</span>
<span class="sd">    &#39;pad&#39; that sets the padding around the bbox in points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">props</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># don&#39;t want to alter the pad externally</span>
    <span class="n">pad</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pad&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">pad</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">points_to_pixels</span><span class="p">(</span><span class="n">pad</span><span class="p">)</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
    <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span>
    <span class="n">l</span> <span class="o">-=</span> <span class="n">pad</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">b</span> <span class="o">-=</span> <span class="n">pad</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">w</span> <span class="o">+=</span> <span class="n">pad</span>
    <span class="n">h</span> <span class="o">+=</span> <span class="n">pad</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
                  <span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
                  <span class="n">height</span><span class="o">=</span><span class="n">h</span><span class="p">,</span>
                  <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
                  <span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">set_transform</span><span class="p">(</span><span class="n">transforms</span><span class="o">.</span><span class="n">IdentityTransform</span><span class="p">())</span>
    <span class="n">r</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">draw_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a debug function to draw a rectangle around the bounding</span>
<span class="sd">    box returned by</span>
<span class="sd">    :meth:`~matplotlib.artist.Artist.get_window_extent` of an artist,</span>
<span class="sd">    to test whether the artist is returning the correct bbox.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
                  <span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
                  <span class="n">height</span><span class="o">=</span><span class="n">h</span><span class="p">,</span>
                  <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                  <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="p">)</span>
    <span class="k">if</span> <span class="n">trans</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">r</span><span class="o">.</span><span class="n">set_transform</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_pprint_table</span><span class="p">(</span><span class="n">_table</span><span class="p">,</span> <span class="n">leadingspace</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given the list of list of strings, return a string of REST table format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">leadingspace</span><span class="p">:</span>
        <span class="n">pad</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">leadingspace</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pad</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="n">columns</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">_table</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
            <span class="n">column</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>

    <span class="n">col_len</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">column</span><span class="p">)</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]</span>

    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">table_formatstr</span> <span class="o">=</span> <span class="n">pad</span> <span class="o">+</span> <span class="s1">&#39;   &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="n">cl</span><span class="p">)</span> <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">col_len</span><span class="p">])</span>

    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_formatstr</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pad</span> <span class="o">+</span> <span class="s1">&#39;   &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">cell</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
                                   <span class="k">for</span> <span class="n">cell</span><span class="p">,</span> <span class="n">cl</span>
                                   <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_table</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col_len</span><span class="p">)]))</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_formatstr</span><span class="p">)</span>

    <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">pad</span> <span class="o">+</span> <span class="s1">&#39;   &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">cell</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
                                     <span class="k">for</span> <span class="n">cell</span><span class="p">,</span> <span class="n">cl</span>
                                     <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col_len</span><span class="p">)]))</span>
                  <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">_table</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>

    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_formatstr</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_pprint_styles</span><span class="p">(</span><span class="n">_styles</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper function for the _Style class.  Given the dictionary of</span>
<span class="sd">    (stylename : styleclass), return a formatted string listing all the</span>
<span class="sd">    styles. Used to update the documentation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">inspect</span>

    <span class="n">_table</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Class&quot;</span><span class="p">,</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Attrs&quot;</span><span class="p">]]</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_styles</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY2</span><span class="p">:</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">varargs</span><span class="p">,</span> <span class="n">varkw</span><span class="p">,</span> <span class="n">defaults</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getargspec</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">varargs</span><span class="p">,</span> <span class="n">varkw</span><span class="p">,</span> <span class="n">defaults</span><span class="p">,</span> <span class="n">kwonlyargs</span><span class="p">,</span> <span class="n">kwonlydefs</span><span class="p">,</span>
                <span class="n">annotations</span><span class="p">)</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[(</span><span class="n">argname</span><span class="p">,</span> <span class="n">argdefault</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">argname</span><span class="p">,</span> <span class="n">argdefault</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">defaults</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">argstr</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">argstr</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">an</span><span class="p">,</span> <span class="n">av</span><span class="p">))</span>
                               <span class="k">for</span> <span class="n">an</span><span class="p">,</span> <span class="n">av</span>
                               <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>

        <span class="c1"># adding ``quotes`` since - and | have special meaning in reST</span>
        <span class="n">_table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;``</span><span class="si">%s</span><span class="s2">``&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="n">argstr</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">_pprint_table</span><span class="p">(</span><span class="n">_table</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_simpleprint_styles</span><span class="p">(</span><span class="n">_styles</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper function for the _Style class.  Given the dictionary of</span>
<span class="sd">    (stylename : styleclass), return a string rep of the list of keys.</span>
<span class="sd">    Used to update the documentation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="s2">&quot; &#39;</span><span class="si">{}</span><span class="s2">&#39; &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_styles</span><span class="p">))))</span>


<span class="k">class</span> <span class="nc">_Style</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A base class for the Styles. It is meant to be a container class,</span>
<span class="sd">    where actual styles are declared as subclass of it, and it</span>
<span class="sd">    provides some helper functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stylename</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the instance of the subclass with the given style name.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># the &quot;class&quot; should have the _style_list attribute, which is</span>
        <span class="c1"># a dictionary of stylname, style class paie.</span>

        <span class="n">_list</span> <span class="o">=</span> <span class="n">stylename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">_name</span> <span class="o">=</span> <span class="n">_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style_list</span><span class="p">[</span><span class="n">_name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown style : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stylename</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">_args_pair</span> <span class="o">=</span> <span class="p">[</span><span class="n">cs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
            <span class="n">_args</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_args_pair</span><span class="p">}</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorrect style argument : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stylename</span><span class="p">)</span>
        <span class="n">_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_cls</span><span class="p">(</span><span class="o">**</span><span class="n">_args</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_styles</span><span class="p">(</span><span class="n">klass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A class method which returns a dictionary of available styles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">klass</span><span class="o">.</span><span class="n">_style_list</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">pprint_styles</span><span class="p">(</span><span class="n">klass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A class method which returns a string of the available styles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_pprint_styles</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">_style_list</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">style</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register a new style.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">_Base</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> must be a subclass of </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">style</span><span class="p">,</span>
                                                              <span class="n">klass</span><span class="o">.</span><span class="n">_Base</span><span class="p">))</span>
        <span class="n">klass</span><span class="o">.</span><span class="n">_style_list</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span>


<span class="k">class</span> <span class="nc">BoxStyle</span><span class="p">(</span><span class="n">_Style</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :class:`BoxStyle` is a container class which defines several</span>
<span class="sd">    boxstyle classes, which are used for :class:`FancyBboxPatch`.</span>

<span class="sd">    A style object can be created as::</span>

<span class="sd">           BoxStyle.Round(pad=0.2)</span>

<span class="sd">    or::</span>

<span class="sd">           BoxStyle(&quot;Round&quot;, pad=0.2)</span>

<span class="sd">    or::</span>

<span class="sd">           BoxStyle(&quot;Round, pad=0.2&quot;)</span>

<span class="sd">    Following boxstyle classes are defined.</span>

<span class="sd">    %(AvailableBoxstyles)s</span>

<span class="sd">    An instance of any boxstyle class is an callable object,</span>
<span class="sd">    whose call signature is::</span>

<span class="sd">       __call__(self, x0, y0, width, height, mutation_size, aspect_ratio=1.)</span>

<span class="sd">    and returns a :class:`Path` instance. *x0*, *y0*, *width* and</span>
<span class="sd">    *height* specify the location and size of the box to be</span>
<span class="sd">    drawn. *mutation_scale* determines the overall size of the</span>
<span class="sd">    mutation (by which I mean the transformation of the rectangle to</span>
<span class="sd">    the fancy box).  *mutation_aspect* determines the aspect-ratio of</span>
<span class="sd">    the mutation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_style_list</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">class</span> <span class="nc">_Base</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :class:`BBoxTransmuterBase` and its derivatives are used to make a</span>
<span class="sd">        fancy box around a given rectangle. The :meth:`__call__` method</span>
<span class="sd">        returns the :class:`~matplotlib.path.Path` of the fancy box. This</span>
<span class="sd">        class is not an artist and actual drawing of the fancy box is done</span>
<span class="sd">        by the :class:`FancyBboxPatch` class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># The derived classes are required to be able to be initialized</span>
        <span class="c1"># w/o arguments, i.e., all its argument (except self) must have</span>
        <span class="c1"># the default values.</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            initializtion.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BoxStyle</span><span class="o">.</span><span class="n">_Base</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            The transmute method is a very core of the</span>
<span class="sd">            :class:`BboxTransmuter` class and must be overridden in the</span>
<span class="sd">            subclasses. It receives the location and size of the</span>
<span class="sd">            rectangle, and the mutation_size, with which the amount of</span>
<span class="sd">            padding and etc. will be scaled. It returns a</span>
<span class="sd">            :class:`~matplotlib.path.Path` instance.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Derived must override&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">,</span>
                     <span class="n">aspect_ratio</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Given the location and size of the box, return the path of</span>
<span class="sd">            the box around it.</span>

<span class="sd">              - *x0*, *y0*, *width*, *height* : location and size of the box</span>
<span class="sd">              - *mutation_size* : a reference scale for the mutation.</span>
<span class="sd">              - *aspect_ratio* : aspect-ration for the mutation.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># The __call__ method is a thin wrapper around the transmute method</span>
            <span class="c1"># and take care of the aspect.</span>

            <span class="k">if</span> <span class="n">aspect_ratio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Squeeze the given height by the aspect_ratio</span>
                <span class="n">y0</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">/</span> <span class="n">aspect_ratio</span><span class="p">,</span> <span class="n">height</span> <span class="o">/</span> <span class="n">aspect_ratio</span>
                <span class="c1"># call transmute method with squeezed height.</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transmute</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">)</span>
                <span class="n">vertices</span><span class="p">,</span> <span class="n">codes</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">codes</span>
                <span class="c1"># Restore the height</span>
                <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">aspect_ratio</span>
                <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transmute</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># because we have decided to nest thes classes, we need to</span>
            <span class="c1"># add some more information to allow instance pickling.</span>
            <span class="kn">import</span> <span class="nn">matplotlib.cbook</span> <span class="k">as</span> <span class="nn">cbook</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">cbook</span><span class="o">.</span><span class="n">_NestedClassGetter</span><span class="p">(),</span>
                    <span class="p">(</span><span class="n">BoxStyle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
                    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Square</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A simple square box.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             *pad*</span>
<span class="sd">                amount of padding</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="n">pad</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BoxStyle</span><span class="o">.</span><span class="n">Square</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">):</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="n">mutation_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad</span>

            <span class="c1"># width and height with padding added.</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">width</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">pad</span><span class="p">,</span> <span class="n">height</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">pad</span>

            <span class="c1"># boundary of the padded box</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">height</span>

            <span class="n">vertices</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)]</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;square&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Square</span>

    <span class="k">class</span> <span class="nc">Circle</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A simple circle box.&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            pad : float</span>
<span class="sd">                The amount of padding around the original box.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="n">pad</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BoxStyle</span><span class="o">.</span><span class="n">Circle</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">):</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="n">mutation_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pad</span><span class="p">,</span> <span class="n">height</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pad</span>

            <span class="c1"># boundary of the padded box</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span>
            <span class="k">return</span> <span class="n">Path</span><span class="o">.</span><span class="n">circle</span><span class="p">((</span><span class="n">x0</span> <span class="o">+</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                               <span class="nb">max</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Circle</span>

    <span class="k">class</span> <span class="nc">LArrow</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        (left) Arrow Box</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="n">pad</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BoxStyle</span><span class="o">.</span><span class="n">LArrow</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">):</span>
            <span class="c1"># padding</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="n">mutation_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad</span>

            <span class="c1"># width and height with padding added.</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">width</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">pad</span><span class="p">,</span> <span class="n">height</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">pad</span>

            <span class="c1"># boundary of the padded box</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">height</span>

            <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
            <span class="n">dxx</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span>
            <span class="c1"># adjust x0.  1.4 &lt;- sqrt(2)</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">pad</span> <span class="o">/</span> <span class="mf">1.4</span>

            <span class="n">cp</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dx</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">dxx</span><span class="p">),</span>  <span class="c1"># arrow</span>
                  <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">y0</span><span class="p">)]</span>

            <span class="n">com</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">com</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">path</span>
    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;larrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LArrow</span>

    <span class="k">class</span> <span class="nc">RArrow</span><span class="p">(</span><span class="n">LArrow</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        (right) Arrow Box</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BoxStyle</span><span class="o">.</span><span class="n">RArrow</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">pad</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">):</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">BoxStyle</span><span class="o">.</span><span class="n">LArrow</span><span class="o">.</span><span class="n">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span>
                                          <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">)</span>

            <span class="n">p</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">width</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">p</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;rarrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RArrow</span>

    <span class="k">class</span> <span class="nc">DArrow</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        (Double) Arrow Box</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This source is copied from LArrow,</span>
        <span class="c1"># modified to add a right arrow to the bbox.</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="n">pad</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BoxStyle</span><span class="o">.</span><span class="n">DArrow</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">):</span>

            <span class="c1"># padding</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="n">mutation_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad</span>

            <span class="c1"># width and height with padding added.</span>
            <span class="c1"># The width is padded by the arrows, so we don&#39;t need to pad it.</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">height</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">pad</span>

            <span class="c1"># boundary of the padded box</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">pad</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">height</span>

            <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
            <span class="n">dxx</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span>
            <span class="c1"># adjust x0.  1.4 &lt;- sqrt(2)</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">pad</span> <span class="o">/</span> <span class="mf">1.4</span>

            <span class="n">cp</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>  <span class="c1"># bot-segment</span>
                  <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">dxx</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dx</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">),</span>  <span class="c1"># right-arrow</span>
                  <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>  <span class="c1"># top-segment</span>
                  <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dx</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">dxx</span><span class="p">),</span>  <span class="c1"># left-arrow</span>
                  <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dxx</span><span class="p">,</span> <span class="n">y0</span><span class="p">)]</span>  <span class="c1"># close-poly</span>

            <span class="n">com</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">com</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">path</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s1">&#39;darrow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DArrow</span>

    <span class="k">class</span> <span class="nc">Round</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A box with round corners.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">rounding_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            *pad*</span>
<span class="sd">              amount of padding</span>

<span class="sd">            *rounding_size*</span>
<span class="sd">              rounding radius of corners. *pad* if None</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="n">pad</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rounding_size</span> <span class="o">=</span> <span class="n">rounding_size</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BoxStyle</span><span class="o">.</span><span class="n">Round</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">):</span>

            <span class="c1"># padding</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="n">mutation_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad</span>

            <span class="c1"># size of the roudning corner</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rounding_size</span><span class="p">:</span>
                <span class="n">dr</span> <span class="o">=</span> <span class="n">mutation_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rounding_size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dr</span> <span class="o">=</span> <span class="n">pad</span>

            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">width</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">pad</span><span class="p">,</span> <span class="n">height</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">pad</span>

            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">height</span>

            <span class="c1"># Round corners are implemented as quadratic bezier. e.g.,</span>
            <span class="c1"># [(x0, y0-dr), (x0, y0), (x0+dr, y0)] for lower left corner.</span>
            <span class="n">cp</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dr</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">dr</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dr</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">dr</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">dr</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dr</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">dr</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dr</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dr</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dr</span><span class="p">,</span> <span class="n">y0</span><span class="p">)]</span>

            <span class="n">com</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">com</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">path</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;round&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Round</span>

    <span class="k">class</span> <span class="nc">Round4</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Another box with round edges.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">rounding_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            *pad*</span>
<span class="sd">              amount of padding</span>

<span class="sd">            *rounding_size*</span>
<span class="sd">              rounding size of edges. *pad* if None</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="n">pad</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rounding_size</span> <span class="o">=</span> <span class="n">rounding_size</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BoxStyle</span><span class="o">.</span><span class="n">Round4</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">):</span>

            <span class="c1"># padding</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="n">mutation_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad</span>

            <span class="c1"># roudning size. Use a half of the pad if not set.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rounding_size</span><span class="p">:</span>
                <span class="n">dr</span> <span class="o">=</span> <span class="n">mutation_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rounding_size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dr</span> <span class="o">=</span> <span class="n">pad</span> <span class="o">/</span> <span class="mf">2.</span>

            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">pad</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dr</span><span class="p">,</span>
                             <span class="n">height</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">pad</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dr</span><span class="p">)</span>

            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">pad</span> <span class="o">+</span> <span class="n">dr</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">pad</span> <span class="o">+</span> <span class="n">dr</span><span class="p">,</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">height</span>

            <span class="n">cp</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dr</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">dr</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">dr</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">dr</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">dr</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dr</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">dr</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">dr</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">dr</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">dr</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dr</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">dr</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="n">dr</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">dr</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="n">dr</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dr</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)]</span>

            <span class="n">com</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span>
                   <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">com</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">path</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;round4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Round4</span>

    <span class="k">class</span> <span class="nc">Sawtooth</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A sawtooth box.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">tooth_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            *pad*</span>
<span class="sd">              amount of padding</span>

<span class="sd">            *tooth_size*</span>
<span class="sd">              size of the sawtooth. pad* if None</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="n">pad</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tooth_size</span> <span class="o">=</span> <span class="n">tooth_size</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BoxStyle</span><span class="o">.</span><span class="n">Sawtooth</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">_get_sawtooth_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">):</span>

            <span class="c1"># padding</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="n">mutation_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad</span>

            <span class="c1"># size of sawtooth</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooth_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tooth_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">mutation_size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tooth_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooth_size</span> <span class="o">*</span> <span class="n">mutation_size</span>

            <span class="n">tooth_size2</span> <span class="o">=</span> <span class="n">tooth_size</span> <span class="o">/</span> <span class="mf">2.</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">pad</span> <span class="o">-</span> <span class="n">tooth_size</span><span class="p">,</span>
                            <span class="n">height</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">pad</span> <span class="o">-</span> <span class="n">tooth_size</span><span class="p">)</span>

            <span class="c1"># the sizes of the vertical and horizontal sawtooth are</span>
            <span class="c1"># separately adjusted to fit the given box size.</span>
            <span class="n">dsx_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">width</span> <span class="o">-</span> <span class="n">tooth_size</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">tooth_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">dsx</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">tooth_size</span><span class="p">)</span> <span class="o">/</span> <span class="n">dsx_n</span>
            <span class="n">dsy_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">height</span> <span class="o">-</span> <span class="n">tooth_size</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">tooth_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">dsy</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span> <span class="o">-</span> <span class="n">tooth_size</span><span class="p">)</span> <span class="o">/</span> <span class="n">dsy_n</span>

            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">pad</span> <span class="o">+</span> <span class="n">tooth_size2</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">pad</span> <span class="o">+</span> <span class="n">tooth_size2</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">height</span>

            <span class="n">bottom_saw_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span> <span class="o">+</span> \
                           <span class="p">[</span><span class="n">x0</span> <span class="o">+</span> <span class="n">tooth_size2</span> <span class="o">+</span> <span class="n">dsx</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">i</span>
                            <span class="k">for</span> <span class="n">i</span>
                            <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dsx_n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">+</span> \
                           <span class="p">[</span><span class="n">x1</span> <span class="o">-</span> <span class="n">tooth_size2</span><span class="p">]</span>

            <span class="n">bottom_saw_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y0</span><span class="p">]</span> <span class="o">+</span> \
                           <span class="p">[</span><span class="n">y0</span> <span class="o">-</span> <span class="n">tooth_size2</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span>
                            <span class="n">y0</span> <span class="o">+</span> <span class="n">tooth_size2</span><span class="p">,</span> <span class="n">y0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dsx_n</span> <span class="o">+</span> \
                           <span class="p">[</span><span class="n">y0</span> <span class="o">-</span> <span class="n">tooth_size2</span><span class="p">]</span>

            <span class="n">right_saw_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="p">]</span> <span class="o">+</span> \
                          <span class="p">[</span><span class="n">x1</span> <span class="o">+</span> <span class="n">tooth_size2</span><span class="p">,</span>
                           <span class="n">x1</span><span class="p">,</span>
                           <span class="n">x1</span> <span class="o">-</span> <span class="n">tooth_size2</span><span class="p">,</span>
                           <span class="n">x1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dsx_n</span> <span class="o">+</span> \
                          <span class="p">[</span><span class="n">x1</span> <span class="o">+</span> <span class="n">tooth_size2</span><span class="p">]</span>

            <span class="n">right_saw_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y0</span><span class="p">]</span> <span class="o">+</span> \
                          <span class="p">[</span><span class="n">y0</span> <span class="o">+</span> <span class="n">tooth_size2</span> <span class="o">+</span> <span class="n">dsy</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">i</span>
                           <span class="k">for</span> <span class="n">i</span>
                           <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dsy_n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">+</span> \
                          <span class="p">[</span><span class="n">y1</span> <span class="o">-</span> <span class="n">tooth_size2</span><span class="p">]</span>

            <span class="n">top_saw_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="p">]</span> <span class="o">+</span> \
                        <span class="p">[</span><span class="n">x1</span> <span class="o">-</span> <span class="n">tooth_size2</span> <span class="o">-</span> <span class="n">dsx</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">i</span>
                         <span class="k">for</span> <span class="n">i</span>
                         <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dsx_n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">+</span> \
                        <span class="p">[</span><span class="n">x0</span> <span class="o">+</span> <span class="n">tooth_size2</span><span class="p">]</span>

            <span class="n">top_saw_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y1</span><span class="p">]</span> <span class="o">+</span> \
                        <span class="p">[</span><span class="n">y1</span> <span class="o">+</span> <span class="n">tooth_size2</span><span class="p">,</span>
                         <span class="n">y1</span><span class="p">,</span>
                         <span class="n">y1</span> <span class="o">-</span> <span class="n">tooth_size2</span><span class="p">,</span>
                         <span class="n">y1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dsx_n</span> <span class="o">+</span> \
                        <span class="p">[</span><span class="n">y1</span> <span class="o">+</span> <span class="n">tooth_size2</span><span class="p">]</span>

            <span class="n">left_saw_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span> <span class="o">+</span> \
                         <span class="p">[</span><span class="n">x0</span> <span class="o">-</span> <span class="n">tooth_size2</span><span class="p">,</span>
                          <span class="n">x0</span><span class="p">,</span>
                          <span class="n">x0</span> <span class="o">+</span> <span class="n">tooth_size2</span><span class="p">,</span>
                          <span class="n">x0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dsy_n</span> <span class="o">+</span> \
                         <span class="p">[</span><span class="n">x0</span> <span class="o">-</span> <span class="n">tooth_size2</span><span class="p">]</span>

            <span class="n">left_saw_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y1</span><span class="p">]</span> <span class="o">+</span> \
                         <span class="p">[</span><span class="n">y1</span> <span class="o">-</span> <span class="n">tooth_size2</span> <span class="o">-</span> <span class="n">dsy</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">i</span>
                          <span class="k">for</span> <span class="n">i</span>
                          <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dsy_n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">+</span> \
                         <span class="p">[</span><span class="n">y0</span> <span class="o">+</span> <span class="n">tooth_size2</span><span class="p">]</span>

            <span class="n">saw_vertices</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bottom_saw_x</span><span class="p">,</span> <span class="n">bottom_saw_y</span><span class="p">))</span> <span class="o">+</span>
                            <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">right_saw_x</span><span class="p">,</span> <span class="n">right_saw_y</span><span class="p">))</span> <span class="o">+</span>
                            <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">top_saw_x</span><span class="p">,</span> <span class="n">top_saw_y</span><span class="p">))</span> <span class="o">+</span>
                            <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">left_saw_x</span><span class="p">,</span> <span class="n">left_saw_y</span><span class="p">))</span> <span class="o">+</span>
                            <span class="p">[(</span><span class="n">bottom_saw_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bottom_saw_y</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>

            <span class="k">return</span> <span class="n">saw_vertices</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">):</span>

            <span class="n">saw_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sawtooth_vertices</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span>
                                                       <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">saw_vertices</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">path</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;sawtooth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sawtooth</span>

    <span class="k">class</span> <span class="nc">Roundtooth</span><span class="p">(</span><span class="n">Sawtooth</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A rounded tooth box.&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">tooth_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            *pad*</span>
<span class="sd">              amount of padding</span>

<span class="sd">            *tooth_size*</span>
<span class="sd">              size of the sawtooth. pad* if None</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BoxStyle</span><span class="o">.</span><span class="n">Roundtooth</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">pad</span><span class="p">,</span> <span class="n">tooth_size</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">):</span>
            <span class="n">saw_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sawtooth_vertices</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span>
                                                       <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
                                                       <span class="n">mutation_size</span><span class="p">)</span>
            <span class="c1"># Add a trailing vertex to allow us to close the polygon correctly</span>
            <span class="n">saw_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">saw_vertices</span><span class="p">),</span>
                                           <span class="p">[</span><span class="n">saw_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="p">([</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">]</span> <span class="o">+</span>
                     <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">saw_vertices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                     <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">saw_vertices</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;roundtooth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Roundtooth</span>

    <span class="k">if</span> <span class="vm">__doc__</span><span class="p">:</span>  <span class="c1"># __doc__ could be None if -OO optimization is enabled</span>
        <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="vm">__doc__</span><span class="p">)</span> <span class="o">%</span> \
               <span class="p">{</span><span class="s2">&quot;AvailableBoxstyles&quot;</span><span class="p">:</span> <span class="n">_pprint_styles</span><span class="p">(</span><span class="n">_style_list</span><span class="p">)}</span>

<span class="n">docstring</span><span class="o">.</span><span class="n">interpd</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="n">AvailableBoxstyles</span><span class="o">=</span><span class="n">_pprint_styles</span><span class="p">(</span><span class="n">BoxStyle</span><span class="o">.</span><span class="n">_style_list</span><span class="p">),</span>
    <span class="n">ListBoxstyles</span><span class="o">=</span><span class="n">_simpleprint_styles</span><span class="p">(</span><span class="n">BoxStyle</span><span class="o">.</span><span class="n">_style_list</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">FancyBboxPatch</span><span class="p">(</span><span class="n">Patch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw a fancy box around a rectangle with lower left at *xy*=(*x*,</span>
<span class="sd">    *y*) with specified width and height.</span>

<span class="sd">    :class:`FancyBboxPatch` class is similar to :class:`Rectangle`</span>
<span class="sd">    class, but it draws a fancy box around the rectangle. The</span>
<span class="sd">    transformation of the rectangle box to the fancy box is delegated</span>
<span class="sd">    to the :class:`BoxTransmuterBase` and its derived classes.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_edge_default</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> \
                           <span class="o">+</span> <span class="s2">&quot;(</span><span class="si">%g</span><span class="s2">,</span><span class="si">%g</span><span class="s2">;</span><span class="si">%g</span><span class="s2">x</span><span class="si">%g</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_height</span><span class="p">)</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
                 <span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span>
                 <span class="n">bbox_transmuter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">mutation_scale</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
                 <span class="n">mutation_aspect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        *xy* = lower left corner</span>

<span class="sd">        *width*, *height*</span>

<span class="sd">        *boxstyle* determines what kind of fancy box will be drawn. It</span>
<span class="sd">        can be a string of the style name with a comma separated</span>
<span class="sd">        attribute, or an instance of :class:`BoxStyle`. Following box</span>
<span class="sd">        styles are available.</span>

<span class="sd">        %(AvailableBoxstyles)s</span>

<span class="sd">        *mutation_scale* : a value with which attributes of boxstyle</span>
<span class="sd">        (e.g., pad) will be scaled. default=1.</span>

<span class="sd">        *mutation_aspect* : The height of the rectangle will be</span>
<span class="sd">        squeezed by this value before the mutation and the mutated</span>
<span class="sd">        box will be stretched by the inverse of it. default=None.</span>

<span class="sd">        Valid kwargs are:</span>
<span class="sd">        %(Patch)s</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Patch</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_height</span> <span class="o">=</span> <span class="n">height</span>

        <span class="k">if</span> <span class="n">boxstyle</span> <span class="o">==</span> <span class="s2">&quot;custom&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bbox_transmuter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bbox_transmuter argument is needed with &quot;</span>
                                 <span class="s2">&quot;custom boxstyle&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bbox_transmuter</span> <span class="o">=</span> <span class="n">bbox_transmuter</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_boxstyle</span><span class="p">(</span><span class="n">boxstyle</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_scale</span> <span class="o">=</span> <span class="n">mutation_scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_aspect</span> <span class="o">=</span> <span class="n">mutation_aspect</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">set_boxstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boxstyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the box style.</span>

<span class="sd">        *boxstyle* can be a string with boxstyle name with optional</span>
<span class="sd">        comma-separated attributes. Alternatively, the attrs can</span>
<span class="sd">        be provided as keywords::</span>

<span class="sd">            set_boxstyle(&quot;round,pad=0.2&quot;)</span>
<span class="sd">            set_boxstyle(&quot;round&quot;, pad=0.2)</span>

<span class="sd">        Old attrs simply are forgotten.</span>

<span class="sd">        Without argument (or with *boxstyle* = None), it returns</span>
<span class="sd">        available box styles.</span>

<span class="sd">        The following boxstyles are available:</span>
<span class="sd">        %(AvailableBoxstyles)s</span>

<span class="sd">        ACCEPTS: %(ListBoxstyles)s</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">boxstyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">BoxStyle</span><span class="o">.</span><span class="n">pprint_styles</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">boxstyle</span><span class="p">,</span> <span class="n">BoxStyle</span><span class="o">.</span><span class="n">_Base</span><span class="p">)</span> <span class="ow">or</span> <span class="n">callable</span><span class="p">(</span><span class="n">boxstyle</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bbox_transmuter</span> <span class="o">=</span> <span class="n">boxstyle</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bbox_transmuter</span> <span class="o">=</span> <span class="n">BoxStyle</span><span class="p">(</span><span class="n">boxstyle</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_mutation_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the mutation scale.</span>

<span class="sd">        ACCEPTS: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_mutation_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the mutation scale.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_scale</span>

    <span class="k">def</span> <span class="nf">set_mutation_aspect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aspect</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the aspect ratio of the bbox mutation.</span>

<span class="sd">        ACCEPTS: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_aspect</span> <span class="o">=</span> <span class="n">aspect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_mutation_aspect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the aspect ratio of the bbox mutation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_aspect</span>

    <span class="k">def</span> <span class="nf">get_boxstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Return the boxstyle object&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bbox_transmuter</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the mutated path of the rectangle</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_boxstyle</span><span class="p">()(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_height</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">get_mutation_scale</span><span class="p">(),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">get_mutation_aspect</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">_path</span>

    <span class="c1"># Following methods are borrowed from the Rectangle class.</span>

    <span class="k">def</span> <span class="nf">get_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Return the left coord of the rectangle&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span>

    <span class="k">def</span> <span class="nf">get_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Return the bottom coord of the rectangle&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span>

    <span class="k">def</span> <span class="nf">get_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Return the width of the  rectangle&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span>

    <span class="k">def</span> <span class="nf">get_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Return the height of the rectangle&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_height</span>

    <span class="k">def</span> <span class="nf">set_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the left coord of the rectangle</span>

<span class="sd">        ACCEPTS: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the bottom coord of the rectangle</span>

<span class="sd">        ACCEPTS: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the width rectangle</span>

<span class="sd">        ACCEPTS: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the width rectangle</span>

<span class="sd">        ACCEPTS: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_height</span> <span class="o">=</span> <span class="n">h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the bounds of the rectangle: l,b,w,h</span>

<span class="sd">        ACCEPTS: (left, bottom, width, height)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_height</span> <span class="o">=</span> <span class="n">h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Bbox</span><span class="o">.</span><span class="n">from_bounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_height</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ConnectionStyle</span><span class="p">(</span><span class="n">_Style</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :class:`ConnectionStyle` is a container class which defines</span>
<span class="sd">    several connectionstyle classes, which is used to create a path</span>
<span class="sd">    between two points. These are mainly used with</span>
<span class="sd">    :class:`FancyArrowPatch`.</span>

<span class="sd">    A connectionstyle object can be either created as::</span>

<span class="sd">           ConnectionStyle.Arc3(rad=0.2)</span>

<span class="sd">    or::</span>

<span class="sd">           ConnectionStyle(&quot;Arc3&quot;, rad=0.2)</span>

<span class="sd">    or::</span>

<span class="sd">           ConnectionStyle(&quot;Arc3, rad=0.2&quot;)</span>

<span class="sd">    The following classes are defined</span>

<span class="sd">    %(AvailableConnectorstyles)s</span>


<span class="sd">    An instance of any connection style class is an callable object,</span>
<span class="sd">    whose call signature is::</span>

<span class="sd">        __call__(self, posA, posB,</span>
<span class="sd">                 patchA=None, patchB=None,</span>
<span class="sd">                 shrinkA=2., shrinkB=2.)</span>

<span class="sd">    and it returns a :class:`Path` instance. *posA* and *posB* are</span>
<span class="sd">    tuples of x,y coordinates of the two points to be</span>
<span class="sd">    connected. *patchA* (or *patchB*) is given, the returned path is</span>
<span class="sd">    clipped so that it start (or end) from the boundary of the</span>
<span class="sd">    patch. The path is further shrunk by *shrinkA* (or *shrinkB*)</span>
<span class="sd">    which is given in points.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_style_list</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">class</span> <span class="nc">_Base</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A base class for connectionstyle classes. The subclass needs</span>
<span class="sd">        to implement a *connect* method whose call signature is::</span>

<span class="sd">          connect(posA, posB)</span>

<span class="sd">        where posA and posB are tuples of x, y coordinates to be</span>
<span class="sd">        connected.  The method needs to return a path connecting two</span>
<span class="sd">        points. This base class defines a __call__ method, and a few</span>
<span class="sd">        helper methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">class</span> <span class="nc">SimpleEvent</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">xy</span>

        <span class="k">def</span> <span class="nf">_clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">patchA</span><span class="p">,</span> <span class="n">patchB</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Clip the path to the boundary of the patchA and patchB.</span>
<span class="sd">            The starting point of the path needed to be inside of the</span>
<span class="sd">            patchA and the end point inside the patch B. The *contains*</span>
<span class="sd">            methods of each patch object is utilized to test if the point</span>
<span class="sd">            is inside the path.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="n">patchA</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">insideA</span><span class="p">(</span><span class="n">xy_display</span><span class="p">):</span>
                    <span class="n">xy_event</span> <span class="o">=</span> <span class="n">ConnectionStyle</span><span class="o">.</span><span class="n">_Base</span><span class="o">.</span><span class="n">SimpleEvent</span><span class="p">(</span><span class="n">xy_display</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">patchA</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">xy_event</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">split_path_inout</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">insideA</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">right</span> <span class="o">=</span> <span class="n">path</span>

                <span class="n">path</span> <span class="o">=</span> <span class="n">right</span>

            <span class="k">if</span> <span class="n">patchB</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">insideB</span><span class="p">(</span><span class="n">xy_display</span><span class="p">):</span>
                    <span class="n">xy_event</span> <span class="o">=</span> <span class="n">ConnectionStyle</span><span class="o">.</span><span class="n">_Base</span><span class="o">.</span><span class="n">SimpleEvent</span><span class="p">(</span><span class="n">xy_display</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">patchB</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">xy_event</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">split_path_inout</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">insideB</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">left</span> <span class="o">=</span> <span class="n">path</span>

                <span class="n">path</span> <span class="o">=</span> <span class="n">left</span>

            <span class="k">return</span> <span class="n">path</span>

        <span class="k">def</span> <span class="nf">_shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">shrinkA</span><span class="p">,</span> <span class="n">shrinkB</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Shrink the path by fixed size (in points) with shrinkA and shrinkB</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">shrinkA</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">insideA</span> <span class="o">=</span> <span class="n">inside_circle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">shrinkA</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">split_path_inout</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">insideA</span><span class="p">)</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">right</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="k">if</span> <span class="n">shrinkB</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">insideB</span> <span class="o">=</span> <span class="n">inside_circle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">shrinkB</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">split_path_inout</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">insideB</span><span class="p">)</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">left</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="k">return</span> <span class="n">path</span>

        <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posA</span><span class="p">,</span> <span class="n">posB</span><span class="p">,</span>
                     <span class="n">shrinkA</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">shrinkB</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">patchA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">patchB</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Calls the *connect* method to create a path between *posA*</span>
<span class="sd">             and *posB*. The path is clipped and shrunken.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">posA</span><span class="p">,</span> <span class="n">posB</span><span class="p">)</span>

            <span class="n">clipped_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clip</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">patchA</span><span class="p">,</span> <span class="n">patchB</span><span class="p">)</span>
            <span class="n">shrunk_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shrink</span><span class="p">(</span><span class="n">clipped_path</span><span class="p">,</span> <span class="n">shrinkA</span><span class="p">,</span> <span class="n">shrinkB</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">shrunk_path</span>

        <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># because we have decided to nest these classes, we need to</span>
            <span class="c1"># add some more information to allow instance pickling.</span>
            <span class="kn">import</span> <span class="nn">matplotlib.cbook</span> <span class="k">as</span> <span class="nn">cbook</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">cbook</span><span class="o">.</span><span class="n">_NestedClassGetter</span><span class="p">(),</span>
                    <span class="p">(</span><span class="n">ConnectionStyle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
                    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Arc3</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a simple quadratic bezier curve between two</span>
<span class="sd">        points. The curve is created so that the middle contol points</span>
<span class="sd">        (C1) is located at the same distance from the start (C0) and</span>
<span class="sd">        end points(C2) and the distance of the C1 to the line</span>
<span class="sd">        connecting C0-C2 is *rad* times the distance of C0-C2.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            *rad*</span>
<span class="sd">              curvature of the curve.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rad</span> <span class="o">=</span> <span class="n">rad</span>

        <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posA</span><span class="p">,</span> <span class="n">posB</span><span class="p">):</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">posA</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">posB</span>
            <span class="n">x12</span><span class="p">,</span> <span class="n">y12</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="p">(</span><span class="n">y1</span> <span class="o">+</span> <span class="n">y2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>

            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad</span>

            <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">x12</span> <span class="o">+</span> <span class="n">f</span> <span class="o">*</span> <span class="n">dy</span><span class="p">,</span> <span class="n">y12</span> <span class="o">-</span> <span class="n">f</span> <span class="o">*</span> <span class="n">dx</span>

            <span class="n">vertices</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)]</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;arc3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Arc3</span>

    <span class="k">class</span> <span class="nc">Angle3</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a simple quadratic bezier curve between two</span>
<span class="sd">        points. The middle control points is placed at the</span>
<span class="sd">        intersecting point of two lines which crosses the start (or</span>
<span class="sd">        end) point and has a angle of angleA (or angleB).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angleA</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">angleB</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            *angleA*</span>
<span class="sd">              starting angle of the path</span>

<span class="sd">            *angleB*</span>
<span class="sd">              ending angle of the path</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">angleA</span> <span class="o">=</span> <span class="n">angleA</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">angleB</span> <span class="o">=</span> <span class="n">angleB</span>

        <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posA</span><span class="p">,</span> <span class="n">posB</span><span class="p">):</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">posA</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">posB</span>

            <span class="n">cosA</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angleA</span><span class="p">))</span>
            <span class="n">sinA</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angleA</span><span class="p">))</span>
            <span class="n">cosB</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angleB</span><span class="p">))</span>
            <span class="n">sinB</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angleB</span><span class="p">))</span>

            <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">get_intersection</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">cosA</span><span class="p">,</span> <span class="n">sinA</span><span class="p">,</span>
                                      <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">cosB</span><span class="p">,</span> <span class="n">sinB</span><span class="p">)</span>

            <span class="n">vertices</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)]</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;angle3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Angle3</span>

    <span class="k">class</span> <span class="nc">Angle</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a picewise continuous quadratic bezier path between</span>
<span class="sd">        two points. The path has a one passing-through point placed at</span>
<span class="sd">        the intersecting point of two lines which crosses the start</span>
<span class="sd">        (or end) point and has a angle of angleA (or angleB).  The</span>
<span class="sd">        connecting edges are rounded with *rad*.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angleA</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">angleB</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            *angleA*</span>
<span class="sd">              starting angle of the path</span>

<span class="sd">            *angleB*</span>
<span class="sd">              ending angle of the path</span>

<span class="sd">            *rad*</span>
<span class="sd">              rounding radius of the edge</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">angleA</span> <span class="o">=</span> <span class="n">angleA</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">angleB</span> <span class="o">=</span> <span class="n">angleB</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rad</span> <span class="o">=</span> <span class="n">rad</span>

        <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posA</span><span class="p">,</span> <span class="n">posB</span><span class="p">):</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">posA</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">posB</span>

            <span class="n">cosA</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angleA</span><span class="p">))</span>
            <span class="n">sinA</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angleA</span><span class="p">))</span>
            <span class="n">cosB</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angleB</span><span class="p">))</span>
            <span class="n">sinB</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angleB</span><span class="p">))</span>

            <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">get_intersection</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">cosA</span><span class="p">,</span> <span class="n">sinA</span><span class="p">,</span>
                                      <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">cosB</span><span class="p">,</span> <span class="n">sinB</span><span class="p">)</span>

            <span class="n">vertices</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">vertices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">))</span>
                <span class="n">codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dx1</span><span class="p">,</span> <span class="n">dy1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">cx</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">cy</span>
                <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx1</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">dy1</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span>
                <span class="n">f1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad</span> <span class="o">/</span> <span class="n">d1</span>
                <span class="n">dx2</span><span class="p">,</span> <span class="n">dy2</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">cx</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">cy</span>
                <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx2</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">dy2</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span>
                <span class="n">f2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad</span> <span class="o">/</span> <span class="n">d2</span>
                <span class="n">vertices</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">cx</span> <span class="o">+</span> <span class="n">dx1</span> <span class="o">*</span> <span class="n">f1</span><span class="p">,</span> <span class="n">cy</span> <span class="o">+</span> <span class="n">dy1</span> <span class="o">*</span> <span class="n">f1</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">cx</span> <span class="o">+</span> <span class="n">dx2</span> <span class="o">*</span> <span class="n">f2</span><span class="p">,</span> <span class="n">cy</span> <span class="o">+</span> <span class="n">dy2</span> <span class="o">*</span> <span class="n">f2</span><span class="p">)])</span>
                <span class="n">codes</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">])</span>

            <span class="n">vertices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
            <span class="n">codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Angle</span>

    <span class="k">class</span> <span class="nc">Arc</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a picewise continuous quadratic bezier path between</span>
<span class="sd">        two points. The path can have two passing-through points, a</span>
<span class="sd">        point placed at the distance of armA and angle of angleA from</span>
<span class="sd">        point A, another point with respect to point B. The edges are</span>
<span class="sd">        rounded with *rad*.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angleA</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">angleB</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">armA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">armB</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            *angleA* :</span>
<span class="sd">              starting angle of the path</span>

<span class="sd">            *angleB* :</span>
<span class="sd">              ending angle of the path</span>

<span class="sd">            *armA* :</span>
<span class="sd">              length of the starting arm</span>

<span class="sd">            *armB* :</span>
<span class="sd">              length of the ending arm</span>

<span class="sd">            *rad* :</span>
<span class="sd">              rounding radius of the edges</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">angleA</span> <span class="o">=</span> <span class="n">angleA</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">angleB</span> <span class="o">=</span> <span class="n">angleB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">armA</span> <span class="o">=</span> <span class="n">armA</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">armB</span> <span class="o">=</span> <span class="n">armB</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rad</span> <span class="o">=</span> <span class="n">rad</span>

        <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posA</span><span class="p">,</span> <span class="n">posB</span><span class="p">):</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">posA</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">posB</span>

            <span class="n">vertices</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">rounded</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">armA</span><span class="p">:</span>
                <span class="n">cosA</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angleA</span><span class="p">))</span>
                <span class="n">sinA</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angleA</span><span class="p">))</span>
                <span class="c1"># x_armA, y_armB</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">armA</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad</span>
                <span class="n">rounded</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x1</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">cosA</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">sinA</span><span class="p">))</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">armA</span>
                <span class="n">rounded</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x1</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">cosA</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">sinA</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">armB</span><span class="p">:</span>
                <span class="n">cosB</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angleB</span><span class="p">))</span>
                <span class="n">sinB</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angleB</span><span class="p">))</span>
                <span class="n">x_armB</span><span class="p">,</span> <span class="n">y_armB</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">armB</span> <span class="o">*</span> <span class="n">cosB</span><span class="p">,</span> <span class="n">y2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">armB</span> <span class="o">*</span> <span class="n">sinB</span>

                <span class="k">if</span> <span class="n">rounded</span><span class="p">:</span>
                    <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span> <span class="o">=</span> <span class="n">rounded</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">x_armB</span> <span class="o">-</span> <span class="n">xp</span><span class="p">,</span> <span class="n">y_armB</span> <span class="o">-</span> <span class="n">yp</span>
                    <span class="n">dd</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span>

                    <span class="n">rounded</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">xp</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">dd</span><span class="p">,</span>
                                    <span class="n">yp</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">dd</span><span class="p">))</span>
                    <span class="n">vertices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rounded</span><span class="p">)</span>
                    <span class="n">codes</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                                  <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                                  <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">x_armB</span> <span class="o">-</span> <span class="n">xp</span><span class="p">,</span> <span class="n">y_armB</span> <span class="o">-</span> <span class="n">yp</span>
                    <span class="n">dd</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span>

                <span class="n">d</span> <span class="o">=</span> <span class="n">dd</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad</span>
                <span class="n">rounded</span> <span class="o">=</span> <span class="p">[(</span><span class="n">xp</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">dd</span><span class="p">,</span> <span class="n">yp</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">dd</span><span class="p">),</span>
                           <span class="p">(</span><span class="n">x_armB</span><span class="p">,</span> <span class="n">y_armB</span><span class="p">)]</span>

            <span class="k">if</span> <span class="n">rounded</span><span class="p">:</span>
                <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span> <span class="o">=</span> <span class="n">rounded</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">xp</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">yp</span>
                <span class="n">dd</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span>

                <span class="n">rounded</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">xp</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">dd</span><span class="p">,</span>
                                <span class="n">yp</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">dd</span><span class="p">))</span>
                <span class="n">vertices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rounded</span><span class="p">)</span>
                <span class="n">codes</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                              <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                              <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">])</span>

            <span class="n">vertices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
            <span class="n">codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;arc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Arc</span>

    <span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A line with *angle* between A and B with *armA* and</span>
<span class="sd">        *armB*. One of the arms is extended so that they are connected in</span>
<span class="sd">        a right angle. The length of armA is determined by (*armA*</span>
<span class="sd">        + *fraction* x AB distance). Same for armB.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">armA</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">armB</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            armA : float</span>
<span class="sd">                minimum length of armA</span>

<span class="sd">            armB : float</span>
<span class="sd">                minimum length of armB</span>

<span class="sd">            fraction : float</span>
<span class="sd">                a fraction of the distance between two points that</span>
<span class="sd">                will be added to armA and armB.</span>

<span class="sd">            angle : float or None</span>
<span class="sd">                angle of the connecting line (if None, parallel</span>
<span class="sd">                to A and B)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">armA</span> <span class="o">=</span> <span class="n">armA</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">armB</span> <span class="o">=</span> <span class="n">armB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fraction</span> <span class="o">=</span> <span class="n">fraction</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span>

        <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posA</span><span class="p">,</span> <span class="n">posB</span><span class="p">):</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">posA</span>
            <span class="n">x20</span><span class="p">,</span> <span class="n">y20</span> <span class="o">=</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">posB</span>

            <span class="n">theta1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span>
            <span class="n">ddx</span><span class="p">,</span> <span class="n">ddy</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">dd</span><span class="p">,</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">dd</span>

            <span class="n">armA</span><span class="p">,</span> <span class="n">armB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">armA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">armB</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">theta0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span>
                <span class="n">dtheta</span> <span class="o">=</span> <span class="n">theta1</span> <span class="o">-</span> <span class="n">theta0</span>
                <span class="n">dl</span> <span class="o">=</span> <span class="n">dd</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dtheta</span><span class="p">)</span>
                <span class="n">dL</span> <span class="o">=</span> <span class="n">dd</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dtheta</span><span class="p">)</span>
                <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">dL</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta0</span><span class="p">),</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">dL</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta0</span><span class="p">)</span>
                <span class="n">armB</span> <span class="o">=</span> <span class="n">armB</span> <span class="o">-</span> <span class="n">dl</span>

                <span class="c1"># update</span>
                <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
                <span class="n">dd2</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span>
                <span class="n">ddx</span><span class="p">,</span> <span class="n">ddy</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">dd2</span><span class="p">,</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">dd2</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">dl</span> <span class="o">=</span> <span class="mf">0.</span>

            <span class="n">arm</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">armA</span><span class="p">,</span> <span class="n">armB</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction</span> <span class="o">*</span> <span class="n">dd</span> <span class="o">+</span> <span class="n">arm</span>

            <span class="n">cx1</span><span class="p">,</span> <span class="n">cy1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">f</span> <span class="o">*</span> <span class="n">ddy</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">f</span> <span class="o">*</span> <span class="n">ddx</span>
            <span class="n">cx2</span><span class="p">,</span> <span class="n">cy2</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">f</span> <span class="o">*</span> <span class="n">ddy</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">f</span> <span class="o">*</span> <span class="n">ddx</span>

            <span class="n">vertices</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">cx1</span><span class="p">,</span> <span class="n">cy1</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">cx2</span><span class="p">,</span> <span class="n">cy2</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">x20</span><span class="p">,</span> <span class="n">y20</span><span class="p">)]</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Bar</span>

    <span class="k">if</span> <span class="vm">__doc__</span><span class="p">:</span>
        <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="vm">__doc__</span><span class="p">)</span> <span class="o">%</span> \
               <span class="p">{</span><span class="s2">&quot;AvailableConnectorstyles&quot;</span><span class="p">:</span> <span class="n">_pprint_styles</span><span class="p">(</span><span class="n">_style_list</span><span class="p">)}</span>


<span class="k">def</span> <span class="nf">_point_along_a_line</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    find a point along a line connecting (x0, y0) -- (x1, y1) whose</span>
<span class="sd">    distance from (x0, y0) is d.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">ff</span> <span class="o">=</span> <span class="n">d</span> <span class="o">/</span> <span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">ff</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">ff</span> <span class="o">*</span> <span class="n">dy</span>

    <span class="k">return</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span>


<span class="k">class</span> <span class="nc">ArrowStyle</span><span class="p">(</span><span class="n">_Style</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :class:`ArrowStyle` is a container class which defines several</span>
<span class="sd">    arrowstyle classes, which is used to create an arrow path along a</span>
<span class="sd">    given path. These are mainly used with :class:`FancyArrowPatch`.</span>

<span class="sd">    A arrowstyle object can be either created as::</span>

<span class="sd">           ArrowStyle.Fancy(head_length=.4, head_width=.4, tail_width=.4)</span>

<span class="sd">    or::</span>

<span class="sd">           ArrowStyle(&quot;Fancy&quot;, head_length=.4, head_width=.4, tail_width=.4)</span>

<span class="sd">    or::</span>

<span class="sd">           ArrowStyle(&quot;Fancy, head_length=.4, head_width=.4, tail_width=.4&quot;)</span>

<span class="sd">    The following classes are defined</span>

<span class="sd">    %(AvailableArrowstyles)s</span>


<span class="sd">    An instance of any arrow style class is a callable object,</span>
<span class="sd">    whose call signature is::</span>

<span class="sd">        __call__(self, path, mutation_size, linewidth, aspect_ratio=1.)</span>

<span class="sd">    and it returns a tuple of a :class:`Path` instance and a boolean</span>
<span class="sd">    value. *path* is a :class:`Path` instance along which the arrow</span>
<span class="sd">    will be drawn. *mutation_size* and *aspect_ratio* have the same</span>
<span class="sd">    meaning as in :class:`BoxStyle`. *linewidth* is a line width to be</span>
<span class="sd">    stroked. This is meant to be used to correct the location of the</span>
<span class="sd">    head so that it does not overshoot the destination point, but not all</span>
<span class="sd">    classes support it.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_style_list</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">class</span> <span class="nc">_Base</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Arrow Transmuter Base class</span>

<span class="sd">        ArrowTransmuterBase and its derivatives are used to make a fancy</span>
<span class="sd">        arrow around a given path. The __call__ method returns a path</span>
<span class="sd">        (which will be used to create a PathPatch instance) and a boolean</span>
<span class="sd">        value indicating the path is open therefore is not fillable.  This</span>
<span class="sd">        class is not an artist and actual drawing of the fancy arrow is</span>
<span class="sd">        done by the FancyArrowPatch class.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># The derived classes are required to be able to be initialized</span>
        <span class="c1"># w/o arguments, i.e., all its argument (except self) must have</span>
        <span class="c1"># the default values.</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">_Base</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="nd">@staticmethod</span>
        <span class="k">def</span> <span class="nf">ensure_quadratic_bezier</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Some ArrowStyle class only wokrs with a simple</span>
<span class="sd">            quaratic bezier curve (created with Arc3Connetion or</span>
<span class="sd">            Angle3Connector). This static method is to check if the</span>
<span class="sd">            provided path is a simple quadratic bezier curve and returns</span>
<span class="sd">            its control points if true.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">segments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">iter_segments</span><span class="p">())</span>
            <span class="k">if</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">segments</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span><span class="n">segments</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">)):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;path&#39; it&#39;s not a valid quadratic bezier curve&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">segments</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">segments</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            The transmute method is the very core of the ArrowStyle</span>
<span class="sd">            class and must be overridden in the subclasses. It receives</span>
<span class="sd">            the path object along which the arrow will be drawn, and</span>
<span class="sd">            the mutation_size, with which the arrow head etc.</span>
<span class="sd">            will be scaled. The linewidth may be used to adjust</span>
<span class="sd">            the path so that it does not pass beyond the given</span>
<span class="sd">            points. It returns a tuple of a Path instance and a</span>
<span class="sd">            boolean. The boolean value indicate whether the path can</span>
<span class="sd">            be filled or not. The return value can also be a list of paths</span>
<span class="sd">            and list of booleans of a same length.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Derived must override&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">,</span>
                     <span class="n">aspect_ratio</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            The __call__ method is a thin wrapper around the transmute method</span>
<span class="sd">            and take care of the aspect ratio.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">make_path_regular</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">aspect_ratio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Squeeze the given height by the aspect_ratio</span>

                <span class="n">vertices</span><span class="p">,</span> <span class="n">codes</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:],</span> <span class="n">path</span><span class="o">.</span><span class="n">codes</span><span class="p">[:]</span>
                <span class="c1"># Squeeze the height</span>
                <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">aspect_ratio</span>
                <span class="n">path_shrunk</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
                <span class="c1"># call transmute method with squeezed height.</span>
                <span class="n">path_mutated</span><span class="p">,</span> <span class="n">fillable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transmute</span><span class="p">(</span><span class="n">path_shrunk</span><span class="p">,</span>
                                                        <span class="n">linewidth</span><span class="p">,</span>
                                                        <span class="n">mutation_size</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cbook</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">fillable</span><span class="p">):</span>
                    <span class="n">path_list</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path_mutated</span><span class="p">):</span>
                        <span class="n">v</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">codes</span>
                        <span class="c1"># Restore the height</span>
                        <span class="n">v</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">aspect_ratio</span>
                        <span class="n">path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
                    <span class="k">return</span> <span class="n">path_list</span><span class="p">,</span> <span class="n">fillable</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">path_mutated</span><span class="p">,</span> <span class="n">fillable</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transmute</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># because we have decided to nest thes classes, we need to</span>
            <span class="c1"># add some more information to allow instance pickling.</span>
            <span class="kn">import</span> <span class="nn">matplotlib.cbook</span> <span class="k">as</span> <span class="nn">cbook</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">cbook</span><span class="o">.</span><span class="n">_NestedClassGetter</span><span class="p">(),</span>
                    <span class="p">(</span><span class="n">ArrowStyle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
                    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">_Curve</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A simple arrow which will work with any path instance. The</span>
<span class="sd">        returned path is simply concatenation of the original path + at</span>
<span class="sd">        most two paths representing the arrow head at the begin point and the</span>
<span class="sd">        at the end point. The arrow heads can be either open or closed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beginarrow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endarrow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">fillbegin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fillend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">head_length</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=.</span><span class="mi">1</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            The arrows are drawn if *beginarrow* and/or *endarrow* are</span>
<span class="sd">            true. *head_length* and *head_width* determines the size</span>
<span class="sd">            of the arrow relative to the *mutation scale*.  The</span>
<span class="sd">            arrowhead at the begin (or end) is closed if fillbegin (or</span>
<span class="sd">            fillend) is True.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beginarrow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endarrow</span> <span class="o">=</span> <span class="n">beginarrow</span><span class="p">,</span> <span class="n">endarrow</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">head_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">head_width</span> <span class="o">=</span> <span class="n">head_length</span><span class="p">,</span> <span class="n">head_width</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fillbegin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fillend</span> <span class="o">=</span> <span class="n">fillbegin</span><span class="p">,</span> <span class="n">fillend</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">_Curve</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">_get_arrow_wedge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span>
                             <span class="n">head_dist</span><span class="p">,</span> <span class="n">cos_t</span><span class="p">,</span> <span class="n">sin_t</span><span class="p">,</span> <span class="n">linewidth</span>
                            <span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Return the paths for arrow heads. Since arrow lines are</span>
<span class="sd">            drawn with capstyle=projected, The arrow goes beyond the</span>
<span class="sd">            desired point. This method also returns the amount of the path</span>
<span class="sd">            to be shrunken so that it does not overshoot.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="c1"># arrow from x0, y0 to x1, y1</span>
            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">y1</span>

            <span class="n">cp_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>

            <span class="c1"># pad_projected : amount of pad to account the</span>
            <span class="c1"># overshooting of the projection of the wedge</span>
            <span class="n">pad_projected</span> <span class="o">=</span> <span class="p">(</span><span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">linewidth</span> <span class="o">/</span> <span class="n">sin_t</span><span class="p">)</span>

            <span class="c1"># Account for division by zero</span>
            <span class="k">if</span> <span class="n">cp_distance</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cp_distance</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># apply pad for projected edge</span>
            <span class="n">ddx</span> <span class="o">=</span> <span class="n">pad_projected</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">cp_distance</span>
            <span class="n">ddy</span> <span class="o">=</span> <span class="n">pad_projected</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">cp_distance</span>

            <span class="c1"># offset for arrow wedge</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">cp_distance</span> <span class="o">*</span> <span class="n">head_dist</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">cp_distance</span> <span class="o">*</span> <span class="n">head_dist</span>

            <span class="n">dx1</span><span class="p">,</span> <span class="n">dy1</span> <span class="o">=</span> <span class="n">cos_t</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">sin_t</span> <span class="o">*</span> <span class="n">dy</span><span class="p">,</span> <span class="o">-</span><span class="n">sin_t</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">cos_t</span> <span class="o">*</span> <span class="n">dy</span>
            <span class="n">dx2</span><span class="p">,</span> <span class="n">dy2</span> <span class="o">=</span> <span class="n">cos_t</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">-</span> <span class="n">sin_t</span> <span class="o">*</span> <span class="n">dy</span><span class="p">,</span> <span class="n">sin_t</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">cos_t</span> <span class="o">*</span> <span class="n">dy</span>

            <span class="n">vertices_arrow</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">ddx</span> <span class="o">+</span> <span class="n">dx1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">ddy</span> <span class="o">+</span> <span class="n">dy1</span><span class="p">),</span>
                              <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">ddx</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">ddy</span><span class="p">),</span>
                              <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">ddx</span> <span class="o">+</span> <span class="n">dx2</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">ddy</span> <span class="o">+</span> <span class="n">dy2</span><span class="p">)]</span>
            <span class="n">codes_arrow</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
                           <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                           <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">vertices_arrow</span><span class="p">,</span> <span class="n">codes_arrow</span><span class="p">,</span> <span class="n">ddx</span><span class="p">,</span> <span class="n">ddy</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">):</span>

            <span class="n">head_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head_length</span> <span class="o">*</span> <span class="n">mutation_size</span>
            <span class="n">head_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head_width</span> <span class="o">*</span> <span class="n">mutation_size</span>
            <span class="n">head_dist</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">head_length</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">head_width</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">cos_t</span><span class="p">,</span> <span class="n">sin_t</span> <span class="o">=</span> <span class="n">head_length</span> <span class="o">/</span> <span class="n">head_dist</span><span class="p">,</span> <span class="n">head_width</span> <span class="o">/</span> <span class="n">head_dist</span>

            <span class="c1"># begin arrow</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># If there is no room for an arrow and a line, then skip the arrow</span>
            <span class="n">has_begin_arrow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beginarrow</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">x0</span> <span class="o">==</span> <span class="n">x1</span> <span class="ow">and</span> <span class="n">y0</span> <span class="o">==</span> <span class="n">y1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">has_begin_arrow</span><span class="p">:</span>
                <span class="n">verticesA</span><span class="p">,</span> <span class="n">codesA</span><span class="p">,</span> <span class="n">ddxA</span><span class="p">,</span> <span class="n">ddyA</span> <span class="o">=</span> \
                           <span class="bp">self</span><span class="o">.</span><span class="n">_get_arrow_wedge</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span>
                                                 <span class="n">head_dist</span><span class="p">,</span> <span class="n">cos_t</span><span class="p">,</span> <span class="n">sin_t</span><span class="p">,</span>
                                                 <span class="n">linewidth</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">verticesA</span><span class="p">,</span> <span class="n">codesA</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
                <span class="n">ddxA</span><span class="p">,</span> <span class="n">ddyA</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span>

            <span class="c1"># end arrow</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># If there is no room for an arrow and a line, then skip the arrow</span>
            <span class="n">has_end_arrow</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endarrow</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">((</span><span class="n">x2</span> <span class="o">==</span> <span class="n">x3</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y2</span> <span class="o">==</span> <span class="n">y3</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">has_end_arrow</span><span class="p">:</span>
                <span class="n">verticesB</span><span class="p">,</span> <span class="n">codesB</span><span class="p">,</span> <span class="n">ddxB</span><span class="p">,</span> <span class="n">ddyB</span> <span class="o">=</span> \
                           <span class="bp">self</span><span class="o">.</span><span class="n">_get_arrow_wedge</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span>
                                                 <span class="n">head_dist</span><span class="p">,</span> <span class="n">cos_t</span><span class="p">,</span> <span class="n">sin_t</span><span class="p">,</span>
                                                 <span class="n">linewidth</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">verticesB</span><span class="p">,</span> <span class="n">codesB</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
                <span class="n">ddxB</span><span class="p">,</span> <span class="n">ddyB</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span>

            <span class="c1"># this simple code will not work if ddx, ddy is greater than</span>
            <span class="c1"># separation bettern vertices.</span>
            <span class="n">_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">ddxA</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">ddyA</span><span class="p">)],</span>
                                          <span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                          <span class="p">[(</span><span class="n">x3</span> <span class="o">+</span> <span class="n">ddxB</span><span class="p">,</span> <span class="n">y3</span> <span class="o">+</span> <span class="n">ddyB</span><span class="p">)]]),</span>
                          <span class="n">path</span><span class="o">.</span><span class="n">codes</span><span class="p">)]</span>
            <span class="n">_fillable</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">has_begin_arrow</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fillbegin</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">verticesA</span><span class="p">,</span> <span class="p">[</span><span class="n">verticesA</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                    <span class="n">verticesA</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">])</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">codesA</span><span class="p">,</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]])</span>
                    <span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
                    <span class="n">_fillable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">verticesA</span><span class="p">,</span> <span class="n">codesA</span><span class="p">))</span>
                    <span class="n">_fillable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">has_end_arrow</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fillend</span><span class="p">:</span>
                    <span class="n">_fillable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">verticesB</span><span class="p">,</span> <span class="p">[</span><span class="n">verticesB</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                    <span class="n">verticesB</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">])</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">codesB</span><span class="p">,</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]])</span>
                    <span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_fillable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">verticesB</span><span class="p">,</span> <span class="n">codesB</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">_path</span><span class="p">,</span> <span class="n">_fillable</span>

    <span class="k">class</span> <span class="nc">Curve</span><span class="p">(</span><span class="n">_Curve</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A simple curve without any arrow head.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">Curve</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="n">beginarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">endarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Curve</span>

    <span class="k">class</span> <span class="nc">CurveA</span><span class="p">(</span><span class="n">_Curve</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An arrow with a head at its begin point.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=.</span><span class="mi">2</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            head_length : float, optional, default : 0.4</span>
<span class="sd">                Length of the arrow head</span>

<span class="sd">            head_width : float, optional, default : 0.2</span>
<span class="sd">                Width of the arrow head</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">CurveA</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                  <span class="n">beginarrow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">endarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">head_length</span><span class="o">=</span><span class="n">head_length</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="n">head_width</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;&lt;-&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CurveA</span>

    <span class="k">class</span> <span class="nc">CurveB</span><span class="p">(</span><span class="n">_Curve</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An arrow with a head at its end point.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=.</span><span class="mi">2</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            head_length : float, optional, default : 0.4</span>
<span class="sd">                Length of the arrow head</span>

<span class="sd">            head_width : float, optional, default : 0.2</span>
<span class="sd">                Width of the arrow head</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">CurveB</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="n">beginarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">endarrow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">head_length</span><span class="o">=</span><span class="n">head_length</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="n">head_width</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CurveB</span>

    <span class="k">class</span> <span class="nc">CurveAB</span><span class="p">(</span><span class="n">_Curve</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An arrow with heads both at the begin and the end point.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=.</span><span class="mi">2</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            head_length : float, optional, default : 0.4</span>
<span class="sd">                Length of the arrow head</span>

<span class="sd">            head_width : float, optional, default : 0.2</span>
<span class="sd">                Width of the arrow head</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">CurveAB</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="n">beginarrow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">endarrow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">head_length</span><span class="o">=</span><span class="n">head_length</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="n">head_width</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;&lt;-&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CurveAB</span>

    <span class="k">class</span> <span class="nc">CurveFilledA</span><span class="p">(</span><span class="n">_Curve</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An arrow with filled triangle head at the begin.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=.</span><span class="mi">2</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            head_length : float, optional, default : 0.4</span>
<span class="sd">                Length of the arrow head</span>

<span class="sd">            head_width : float, optional, default : 0.2</span>
<span class="sd">                Width of the arrow head</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">CurveFilledA</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="n">beginarrow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">endarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">fillbegin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fillend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">head_length</span><span class="o">=</span><span class="n">head_length</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="n">head_width</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;&lt;|-&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CurveFilledA</span>

    <span class="k">class</span> <span class="nc">CurveFilledB</span><span class="p">(</span><span class="n">_Curve</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An arrow with filled triangle head at the end.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=.</span><span class="mi">2</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            head_length : float, optional, default : 0.4</span>
<span class="sd">                Length of the arrow head</span>

<span class="sd">            head_width : float, optional, default : 0.2</span>
<span class="sd">                Width of the arrow head</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">CurveFilledB</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="n">beginarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">endarrow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">fillbegin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fillend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">head_length</span><span class="o">=</span><span class="n">head_length</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="n">head_width</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CurveFilledB</span>

    <span class="k">class</span> <span class="nc">CurveFilledAB</span><span class="p">(</span><span class="n">_Curve</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An arrow with filled triangle heads at both ends.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=.</span><span class="mi">2</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            head_length : float, optional, default : 0.4</span>
<span class="sd">                Length of the arrow head</span>

<span class="sd">            head_width : float, optional, default : 0.2</span>
<span class="sd">                Width of the arrow head</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">CurveFilledAB</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="n">beginarrow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">endarrow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">fillbegin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fillend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">head_length</span><span class="o">=</span><span class="n">head_length</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="n">head_width</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;&lt;|-|&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CurveFilledAB</span>

    <span class="k">class</span> <span class="nc">_Bracket</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bracketA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bracketB</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">widthA</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">widthB</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
                     <span class="n">lengthA</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">lengthB</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                     <span class="n">angleA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">angleB</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">scaleA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scaleB</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bracketA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bracketB</span> <span class="o">=</span> <span class="n">bracketA</span><span class="p">,</span> <span class="n">bracketB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">widthA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">widthB</span> <span class="o">=</span> <span class="n">widthA</span><span class="p">,</span> <span class="n">widthB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lengthA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lengthB</span> <span class="o">=</span> <span class="n">lengthA</span><span class="p">,</span> <span class="n">lengthB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">angleA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angleB</span> <span class="o">=</span> <span class="n">angleA</span><span class="p">,</span> <span class="n">angleB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scaleA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaleB</span> <span class="o">=</span> <span class="n">scaleA</span><span class="p">,</span> <span class="n">scaleB</span>

        <span class="k">def</span> <span class="nf">_get_bracket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span>
                         <span class="n">cos_t</span><span class="p">,</span> <span class="n">sin_t</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>

            <span class="c1"># arrow from x0, y0 to x1, y1</span>
            <span class="kn">from</span> <span class="nn">matplotlib.bezier</span> <span class="k">import</span> <span class="n">get_normal_points</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">get_normal_points</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">cos_t</span><span class="p">,</span> <span class="n">sin_t</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">cos_t</span><span class="p">,</span> <span class="n">length</span> <span class="o">*</span> <span class="n">sin_t</span>

            <span class="n">vertices_arrow</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">dy</span><span class="p">),</span>
                              <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                              <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span>
                              <span class="p">(</span><span class="n">x2</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)]</span>
            <span class="n">codes_arrow</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
                           <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                           <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                           <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">vertices_arrow</span><span class="p">,</span> <span class="n">codes_arrow</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaleA</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">scaleA</span> <span class="o">=</span> <span class="n">mutation_size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scaleA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaleA</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaleB</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">scaleB</span> <span class="o">=</span> <span class="n">mutation_size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scaleB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaleB</span>

            <span class="n">vertices_list</span><span class="p">,</span> <span class="n">codes_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bracketA</span><span class="p">:</span>
                <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">cos_t</span><span class="p">,</span> <span class="n">sin_t</span> <span class="o">=</span> <span class="n">get_cos_sin</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
                <span class="n">verticesA</span><span class="p">,</span> <span class="n">codesA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bracket</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">cos_t</span><span class="p">,</span> <span class="n">sin_t</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">widthA</span> <span class="o">*</span> <span class="n">scaleA</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">lengthA</span> <span class="o">*</span> <span class="n">scaleA</span><span class="p">)</span>
                <span class="n">vertices_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verticesA</span><span class="p">)</span>
                <span class="n">codes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">codesA</span><span class="p">)</span>

            <span class="n">vertices_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span>
            <span class="n">codes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">codes</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bracketB</span><span class="p">:</span>
                <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">cos_t</span><span class="p">,</span> <span class="n">sin_t</span> <span class="o">=</span> <span class="n">get_cos_sin</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
                <span class="n">verticesB</span><span class="p">,</span> <span class="n">codesB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bracket</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">cos_t</span><span class="p">,</span> <span class="n">sin_t</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">widthB</span> <span class="o">*</span> <span class="n">scaleB</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">lengthB</span> <span class="o">*</span> <span class="n">scaleB</span><span class="p">)</span>
                <span class="n">vertices_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verticesB</span><span class="p">)</span>
                <span class="n">codes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">codesB</span><span class="p">)</span>

            <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">vertices_list</span><span class="p">)</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">codes_list</span><span class="p">)</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">p</span><span class="p">,</span> <span class="kc">False</span>

    <span class="k">class</span> <span class="nc">BracketAB</span><span class="p">(</span><span class="n">_Bracket</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An arrow with a bracket(]) at both ends.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">widthA</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">lengthA</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">angleA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">widthB</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">lengthB</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">angleB</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            widthA : float, optional, default : 1.0</span>
<span class="sd">                Width of the bracket</span>

<span class="sd">            lengthA : float, optional, default : 0.2</span>
<span class="sd">                Length of the bracket</span>

<span class="sd">            angleA : float, optional, default : None</span>
<span class="sd">                Angle between the bracket and the line</span>

<span class="sd">            widthB : float, optional, default : 1.0</span>
<span class="sd">                Width of the bracket</span>

<span class="sd">            lengthB : float, optional, default : 0.2</span>
<span class="sd">                Length of the bracket</span>

<span class="sd">            angleB : float, optional, default : None</span>
<span class="sd">                Angle between the bracket and the line</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">BracketAB</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                        <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">widthA</span><span class="o">=</span><span class="n">widthA</span><span class="p">,</span> <span class="n">lengthA</span><span class="o">=</span><span class="n">lengthA</span><span class="p">,</span>
                        <span class="n">angleA</span><span class="o">=</span><span class="n">angleA</span><span class="p">,</span> <span class="n">widthB</span><span class="o">=</span><span class="n">widthB</span><span class="p">,</span> <span class="n">lengthB</span><span class="o">=</span><span class="n">lengthB</span><span class="p">,</span>
                        <span class="n">angleB</span><span class="o">=</span><span class="n">angleB</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;]-[&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BracketAB</span>

    <span class="k">class</span> <span class="nc">BracketA</span><span class="p">(</span><span class="n">_Bracket</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An arrow with a bracket(])  at its end.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widthA</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">lengthA</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">angleA</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            widthA : float, optional, default : 1.0</span>
<span class="sd">                Width of the bracket</span>

<span class="sd">            lengthA : float, optional, default : 0.2</span>
<span class="sd">                Length of the bracket</span>

<span class="sd">            angleA : float, optional, default : None</span>
<span class="sd">                Angle between the bracket and the line</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">BracketA</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                                      <span class="n">widthA</span><span class="o">=</span><span class="n">widthA</span><span class="p">,</span>
                                                      <span class="n">lengthA</span><span class="o">=</span><span class="n">lengthA</span><span class="p">,</span>
                                                      <span class="n">angleA</span><span class="o">=</span><span class="n">angleA</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;]-&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BracketA</span>

    <span class="k">class</span> <span class="nc">BracketB</span><span class="p">(</span><span class="n">_Bracket</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An arrow with a bracket([)  at its end.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widthB</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">lengthB</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">angleB</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            widthB : float, optional, default : 1.0</span>
<span class="sd">                Width of the bracket</span>

<span class="sd">            lengthB : float, optional, default : 0.2</span>
<span class="sd">                Length of the bracket</span>

<span class="sd">            angleB : float, optional, default : None</span>
<span class="sd">                Angle between the bracket and the line</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">BracketB</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
                                                      <span class="n">widthB</span><span class="o">=</span><span class="n">widthB</span><span class="p">,</span>
                                                      <span class="n">lengthB</span><span class="o">=</span><span class="n">lengthB</span><span class="p">,</span>
                                                      <span class="n">angleB</span><span class="o">=</span><span class="n">angleB</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;-[&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BracketB</span>

    <span class="k">class</span> <span class="nc">BarAB</span><span class="p">(</span><span class="n">_Bracket</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An arrow with a bar(|) at both ends.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">widthA</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">angleA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">widthB</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">angleB</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            widthA : float, optional, default : 1.0</span>
<span class="sd">                Width of the bracket</span>

<span class="sd">            angleA : float, optional, default : None</span>
<span class="sd">                Angle between the bracket and the line</span>

<span class="sd">            widthB : float, optional, default : 1.0</span>
<span class="sd">                Width of the bracket</span>

<span class="sd">            angleB : float, optional, default : None</span>
<span class="sd">                Angle between the bracket and the line</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">BarAB</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                        <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">widthA</span><span class="o">=</span><span class="n">widthA</span><span class="p">,</span> <span class="n">lengthA</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">angleA</span><span class="o">=</span><span class="n">angleA</span><span class="p">,</span>
                        <span class="n">widthB</span><span class="o">=</span><span class="n">widthB</span><span class="p">,</span> <span class="n">lengthB</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">angleB</span><span class="o">=</span><span class="n">angleB</span><span class="p">)</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;|-|&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BarAB</span>

    <span class="k">class</span> <span class="nc">Simple</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A simple arrow. Only works with a quadratic bezier curve.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">tail_width</span><span class="o">=.</span><span class="mi">2</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            head_length : float, optional, default : 0.5</span>
<span class="sd">                Length of the arrow head</span>

<span class="sd">            head_width : float, optional, default : 0.5</span>
<span class="sd">                Width of the arrow head</span>

<span class="sd">            tail_width : float, optional, default : 0.2</span>
<span class="sd">                Width of the arrow tail</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">head_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">head_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tail_width</span> <span class="o">=</span> \
                <span class="n">head_length</span><span class="p">,</span> <span class="n">head_width</span><span class="p">,</span> <span class="n">tail_width</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">Simple</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">):</span>

            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensure_quadratic_bezier</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="c1"># divide the path into a head and a tail</span>
            <span class="n">head_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head_length</span> <span class="o">*</span> <span class="n">mutation_size</span>
            <span class="n">in_f</span> <span class="o">=</span> <span class="n">inside_circle</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">head_length</span><span class="p">)</span>
            <span class="n">arrow_path</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)]</span>

            <span class="kn">from</span> <span class="nn">.bezier</span> <span class="k">import</span> <span class="n">NonIntersectingPathException</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">arrow_out</span><span class="p">,</span> <span class="n">arrow_in</span> <span class="o">=</span> \
                      <span class="n">split_bezier_intersecting_with_closedpath</span><span class="p">(</span><span class="n">arrow_path</span><span class="p">,</span>
                                                                <span class="n">in_f</span><span class="p">,</span>
                                                                <span class="n">tolerence</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">NonIntersectingPathException</span><span class="p">:</span>
                <span class="c1"># if this happens, make a straight line of the head_length</span>
                <span class="c1"># long.</span>
                <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">_point_along_a_line</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">head_length</span><span class="p">)</span>
                <span class="n">x1n</span><span class="p">,</span> <span class="n">y1n</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">x2</span><span class="p">),</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y2</span><span class="p">)</span>
                <span class="n">arrow_in</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1n</span><span class="p">,</span> <span class="n">y1n</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)]</span>
                <span class="n">arrow_out</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># head</span>
            <span class="n">head_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head_width</span> <span class="o">*</span> <span class="n">mutation_size</span>
            <span class="n">head_left</span><span class="p">,</span> <span class="n">head_right</span> <span class="o">=</span> <span class="n">make_wedged_bezier2</span><span class="p">(</span><span class="n">arrow_in</span><span class="p">,</span>
                                                        <span class="n">head_width</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">wm</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>

            <span class="c1"># tail</span>
            <span class="k">if</span> <span class="n">arrow_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tail_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tail_width</span> <span class="o">*</span> <span class="n">mutation_size</span>
                <span class="n">tail_left</span><span class="p">,</span> <span class="n">tail_right</span> <span class="o">=</span> <span class="n">get_parallels</span><span class="p">(</span><span class="n">arrow_out</span><span class="p">,</span>
                                                      <span class="n">tail_width</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>

                <span class="n">patch_path</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">tail_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">tail_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">tail_right</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">head_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">head_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">head_right</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">head_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">head_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">tail_left</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">tail_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">tail_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">tail_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">,</span> <span class="n">tail_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                              <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">patch_path</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">head_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">head_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">head_right</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">head_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">head_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                              <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">,</span> <span class="n">head_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                              <span class="p">]</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patch_path</span><span class="p">],</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patch_path</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">path</span><span class="p">,</span> <span class="kc">True</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;simple&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Simple</span>

    <span class="k">class</span> <span class="nc">Fancy</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A fancy arrow. Only works with a quadratic bezier curve.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span> <span class="n">tail_width</span><span class="o">=.</span><span class="mi">4</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            head_length : float, optional, default : 0.4</span>
<span class="sd">                Length of the arrow head</span>

<span class="sd">            head_width : float, optional, default : 0.4</span>
<span class="sd">                Width of the arrow head</span>

<span class="sd">            tail_width : float, optional, default : 0.4</span>
<span class="sd">                Width of the arrow tail</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">head_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">head_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tail_width</span> <span class="o">=</span> \
                <span class="n">head_length</span><span class="p">,</span> <span class="n">head_width</span><span class="p">,</span> <span class="n">tail_width</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">Fancy</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">):</span>

            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensure_quadratic_bezier</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="c1"># divide the path into a head and a tail</span>
            <span class="n">head_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head_length</span> <span class="o">*</span> <span class="n">mutation_size</span>
            <span class="n">arrow_path</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)]</span>

            <span class="kn">from</span> <span class="nn">.bezier</span> <span class="k">import</span> <span class="n">NonIntersectingPathException</span>

            <span class="c1"># path for head</span>
            <span class="n">in_f</span> <span class="o">=</span> <span class="n">inside_circle</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">head_length</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">path_out</span><span class="p">,</span> <span class="n">path_in</span> <span class="o">=</span> \
                          <span class="n">split_bezier_intersecting_with_closedpath</span><span class="p">(</span>
                                <span class="n">arrow_path</span><span class="p">,</span>
                                <span class="n">in_f</span><span class="p">,</span>
                                <span class="n">tolerence</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">NonIntersectingPathException</span><span class="p">:</span>
                <span class="c1"># if this happens, make a straight line of the head_length</span>
                <span class="c1"># long.</span>
                <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">_point_along_a_line</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">head_length</span><span class="p">)</span>
                <span class="n">x1n</span><span class="p">,</span> <span class="n">y1n</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">x2</span><span class="p">),</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y2</span><span class="p">)</span>
                <span class="n">arrow_path</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1n</span><span class="p">,</span> <span class="n">y1n</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)]</span>
                <span class="n">path_head</span> <span class="o">=</span> <span class="n">arrow_path</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">path_head</span> <span class="o">=</span> <span class="n">path_in</span>

            <span class="c1"># path for head</span>
            <span class="n">in_f</span> <span class="o">=</span> <span class="n">inside_circle</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">head_length</span> <span class="o">*</span> <span class="o">.</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">path_out</span><span class="p">,</span> <span class="n">path_in</span> <span class="o">=</span> <span class="n">split_bezier_intersecting_with_closedpath</span><span class="p">(</span>
                                        <span class="n">arrow_path</span><span class="p">,</span>
                                        <span class="n">in_f</span><span class="p">,</span>
                                        <span class="n">tolerence</span><span class="o">=</span><span class="mf">0.01</span>
                                <span class="p">)</span>
            <span class="n">path_tail</span> <span class="o">=</span> <span class="n">path_out</span>

            <span class="c1"># head</span>
            <span class="n">head_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head_width</span> <span class="o">*</span> <span class="n">mutation_size</span>
            <span class="n">head_l</span><span class="p">,</span> <span class="n">head_r</span> <span class="o">=</span> <span class="n">make_wedged_bezier2</span><span class="p">(</span><span class="n">path_head</span><span class="p">,</span>
                                                 <span class="n">head_width</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span>
                                                 <span class="n">wm</span><span class="o">=.</span><span class="mi">6</span><span class="p">)</span>

            <span class="c1"># tail</span>
            <span class="n">tail_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tail_width</span> <span class="o">*</span> <span class="n">mutation_size</span>
            <span class="n">tail_left</span><span class="p">,</span> <span class="n">tail_right</span> <span class="o">=</span> <span class="n">make_wedged_bezier2</span><span class="p">(</span><span class="n">path_tail</span><span class="p">,</span>
                                                        <span class="n">tail_width</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span>
                                                        <span class="n">w1</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">wm</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">w2</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

            <span class="c1"># path for head</span>
            <span class="n">in_f</span> <span class="o">=</span> <span class="n">inside_circle</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">tail_width</span> <span class="o">*</span> <span class="o">.</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">path_in</span><span class="p">,</span> <span class="n">path_out</span> <span class="o">=</span> <span class="n">split_bezier_intersecting_with_closedpath</span><span class="p">(</span>
                                    <span class="n">arrow_path</span><span class="p">,</span>
                                    <span class="n">in_f</span><span class="p">,</span>
                                    <span class="n">tolerence</span><span class="o">=</span><span class="mf">0.01</span>
                                <span class="p">)</span>
            <span class="n">tail_start</span> <span class="o">=</span> <span class="n">path_in</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">head_right</span><span class="p">,</span> <span class="n">head_left</span> <span class="o">=</span> <span class="n">head_r</span><span class="p">,</span> <span class="n">head_l</span>
            <span class="n">patch_path</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">tail_start</span><span class="p">),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">tail_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">tail_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">tail_right</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">head_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">head_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">head_right</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">head_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">head_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">tail_left</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">tail_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">tail_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">tail_start</span><span class="p">),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">,</span> <span class="n">tail_start</span><span class="p">),</span>
                          <span class="p">]</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patch_path</span><span class="p">],</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patch_path</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">path</span><span class="p">,</span> <span class="kc">True</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;fancy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Fancy</span>

    <span class="k">class</span> <span class="nc">Wedge</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wedge(?) shape. Only works with a quadratic bezier curve.  The</span>
<span class="sd">        begin point has a width of the tail_width and the end point has a</span>
<span class="sd">        width of 0. At the middle, the width is shrink_factor*tail_width.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tail_width</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">shrink_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            tail_width : float, optional, default : 0.3</span>
<span class="sd">                Width of the tail</span>

<span class="sd">            shrink_factor : float, optional, default : 0.5</span>
<span class="sd">                Fraction of the arrow width at the middle point</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tail_width</span> <span class="o">=</span> <span class="n">tail_width</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shrink_factor</span> <span class="o">=</span> <span class="n">shrink_factor</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">Wedge</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mutation_size</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">):</span>

            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensure_quadratic_bezier</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="n">arrow_path</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)]</span>
            <span class="n">b_plus</span><span class="p">,</span> <span class="n">b_minus</span> <span class="o">=</span> <span class="n">make_wedged_bezier2</span><span class="p">(</span>
                                    <span class="n">arrow_path</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">tail_width</span> <span class="o">*</span> <span class="n">mutation_size</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span>
                                    <span class="n">wm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shrink_factor</span><span class="p">)</span>

            <span class="n">patch_path</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">b_plus</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">b_plus</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">b_plus</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">b_minus</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">b_minus</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">b_minus</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                          <span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">,</span> <span class="n">b_minus</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                          <span class="p">]</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patch_path</span><span class="p">],</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patch_path</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">path</span><span class="p">,</span> <span class="kc">True</span>

    <span class="n">_style_list</span><span class="p">[</span><span class="s2">&quot;wedge&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Wedge</span>

    <span class="k">if</span> <span class="vm">__doc__</span><span class="p">:</span>
        <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="vm">__doc__</span><span class="p">)</span> <span class="o">%</span> \
               <span class="p">{</span><span class="s2">&quot;AvailableArrowstyles&quot;</span><span class="p">:</span> <span class="n">_pprint_styles</span><span class="p">(</span><span class="n">_style_list</span><span class="p">)}</span>


<span class="n">docstring</span><span class="o">.</span><span class="n">interpd</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="n">AvailableArrowstyles</span><span class="o">=</span><span class="n">_pprint_styles</span><span class="p">(</span><span class="n">ArrowStyle</span><span class="o">.</span><span class="n">_style_list</span><span class="p">),</span>
    <span class="n">AvailableConnectorstyles</span><span class="o">=</span><span class="n">_pprint_styles</span><span class="p">(</span><span class="n">ConnectionStyle</span><span class="o">.</span><span class="n">_style_list</span><span class="p">),</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">FancyArrowPatch</span><span class="p">(</span><span class="n">Patch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A fancy arrow patch. It draws an arrow using the :class:`ArrowStyle`.</span>

<span class="sd">    The head and tail positions are fixed at the specified start and end points</span>
<span class="sd">    of the arrow, but the size and shape (in display coordinates) of the arrow</span>
<span class="sd">    does not change when the axis is moved or zoomed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_edge_default</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_posA_posB</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_posA_posB</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> \
                <span class="o">+</span> <span class="s2">&quot;(</span><span class="si">%g</span><span class="s2">,</span><span class="si">%g</span><span class="s2">-&gt;</span><span class="si">%g</span><span class="s2">,</span><span class="si">%g</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> \
                <span class="o">+</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_original</span><span class="p">),)</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">posB</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;simple&quot;</span><span class="p">,</span>
                 <span class="n">arrow_transmuter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3&quot;</span><span class="p">,</span>
                 <span class="n">connector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">patchA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">patchB</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">shrinkA</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                 <span class="n">shrinkB</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                 <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">mutation_aspect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">dpi_cor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If *posA* and *posB* are given, a path connecting two points is</span>
<span class="sd">        created according to *connectionstyle*. The path will be</span>
<span class="sd">        clipped with *patchA* and *patchB* and further shrunken by</span>
<span class="sd">        *shrinkA* and *shrinkB*. An arrow is drawn along this</span>
<span class="sd">        resulting path using the *arrowstyle* parameter.</span>

<span class="sd">        Alternatively if *path* is provided, an arrow is drawn along this path</span>
<span class="sd">        and *patchA*, *patchB*, *shrinkA*, and *shrinkB* are ignored.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        posA, posB : None, tuple, optional (default: None)</span>
<span class="sd">            (x,y) coordinates of arrow tail and arrow head respectively.</span>

<span class="sd">        path : None, Path (default: None)</span>
<span class="sd">            :class:`matplotlib.path.Path` instance. If provided, an arrow is</span>
<span class="sd">            drawn along this path and *patchA*, *patchB*, *shrinkA*, and</span>
<span class="sd">            *shrinkB* are ignored.</span>

<span class="sd">        arrowstyle : str or ArrowStyle, optional (default: &#39;simple&#39;)</span>
<span class="sd">            Describes how the fancy arrow will be</span>
<span class="sd">            drawn. It can be string of the available arrowstyle names,</span>
<span class="sd">            with optional comma-separated attributes, or an</span>
<span class="sd">            :class:`ArrowStyle` instance. The optional attributes are meant to</span>
<span class="sd">            be scaled with the *mutation_scale*. The following arrow styles are</span>
<span class="sd">            available:</span>

<span class="sd">            %(AvailableArrowstyles)s</span>

<span class="sd">        arrow_transmuter :</span>
<span class="sd">            Ignored</span>

<span class="sd">        connectionstyle : str, ConnectionStyle, or None, optional</span>
<span class="sd">        (default: &#39;arc3&#39;)</span>
<span class="sd">            Describes how *posA* and *posB* are connected. It can be an</span>
<span class="sd">            instance of the :class:`ConnectionStyle` class or a string of the</span>
<span class="sd">            connectionstyle name, with optional comma-separated attributes. The</span>
<span class="sd">            following connection styles are available:</span>

<span class="sd">            %(AvailableConnectorstyles)s</span>

<span class="sd">        connector :</span>
<span class="sd">            Ignored</span>

<span class="sd">        patchA, patchB : None, Patch, optional (default: None)</span>
<span class="sd">            Head and tail patch respectively. :class:`matplotlib.patch.Patch`</span>
<span class="sd">            instance.</span>

<span class="sd">        shrinkA, shrinkB : scalar, optional (default: 2)</span>
<span class="sd">            Shrinking factor of the tail and head of the arrow respectively</span>

<span class="sd">        mutation_scale : scalar, optional (default: 1)</span>
<span class="sd">            Value with which attributes of *arrowstyle* (e.g., *head_length*)</span>
<span class="sd">            will be scaled.</span>

<span class="sd">        mutation_aspect : None, scalar, optional (default: None)</span>
<span class="sd">            The height of the rectangle will be squeezed by this value before</span>
<span class="sd">            the mutation and the mutated box will be stretched by the inverse</span>
<span class="sd">            of it.</span>

<span class="sd">        dpi_cor : scalar, optional (default: 1)</span>
<span class="sd">            dpi_cor is currently used for linewidth-related things and shrink</span>
<span class="sd">            factor. Mutation scale is affected by this.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Valid kwargs are:</span>
<span class="sd">        %(Patch)s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Patch</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">posA</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">posB</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_posA_posB</span> <span class="o">=</span> <span class="p">[</span><span class="n">posA</span><span class="p">,</span> <span class="n">posB</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">connectionstyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">connectionstyle</span> <span class="o">=</span> <span class="s2">&quot;arc3&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_connectionstyle</span><span class="p">(</span><span class="n">connectionstyle</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">posA</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">posB</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_posA_posB</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connetors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;either posA and posB, or path need to provided&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">patchA</span> <span class="o">=</span> <span class="n">patchA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patchB</span> <span class="o">=</span> <span class="n">patchB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shrinkA</span> <span class="o">=</span> <span class="n">shrinkA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shrinkB</span> <span class="o">=</span> <span class="n">shrinkB</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_path_original</span> <span class="o">=</span> <span class="n">path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_arrowstyle</span><span class="p">(</span><span class="n">arrowstyle</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_scale</span> <span class="o">=</span> <span class="n">mutation_scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_aspect</span> <span class="o">=</span> <span class="n">mutation_aspect</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_dpi_cor</span><span class="p">(</span><span class="n">dpi_cor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_dpi_cor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dpi_cor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        dpi_cor is currently used for linewidth-related things and</span>
<span class="sd">        shrink factor. Mutation scale is affected by this.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dpi_cor : scalar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dpi_cor</span> <span class="o">=</span> <span class="n">dpi_cor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_dpi_cor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        dpi_cor is currently used for linewidth-related things and</span>
<span class="sd">        shrink factor. Mutation scale is affected by this.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dpi_cor : scalar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dpi_cor</span>

    <span class="k">def</span> <span class="nf">set_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posA</span><span class="p">,</span> <span class="n">posB</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the begin and end positions of the connecting path.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        posA, posB : None, tuple</span>
<span class="sd">            (x,y) coordinates of arrow tail and arrow head respectively. If</span>
<span class="sd">            `None` use current value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">posA</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_posA_posB</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">posA</span>
        <span class="k">if</span> <span class="n">posB</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_posA_posB</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">posB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_patchA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patchA</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the tail patch.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        patchA : Patch</span>
<span class="sd">            :class:`matplotlib.patch.Patch` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patchA</span> <span class="o">=</span> <span class="n">patchA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_patchB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patchB</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the head patch.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        patchB : Patch</span>
<span class="sd">            :class:`matplotlib.patch.Patch` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patchB</span> <span class="o">=</span> <span class="n">patchB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_connectionstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connectionstyle</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the connection style. Old attributes are forgotten.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        connectionstyle : None, ConnectionStyle instance, or string</span>
<span class="sd">            Can be a string with connectionstyle name with</span>
<span class="sd">            optional comma-separated attributes, e.g.::</span>

<span class="sd">                set_connectionstyle(&quot;arc,angleA=0,armA=30,rad=10&quot;)</span>

<span class="sd">            Alternatively, the attributes can be provided as keywords, e.g.::</span>

<span class="sd">                set_connectionstyle(&quot;arc&quot;, angleA=0,armA=30,rad=10)</span>

<span class="sd">            Without any arguments (or with ``connectionstyle=None``), return</span>
<span class="sd">            available styles as a list of strings.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">connectionstyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ConnectionStyle</span><span class="o">.</span><span class="n">pprint_styles</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">connectionstyle</span><span class="p">,</span> <span class="n">ConnectionStyle</span><span class="o">.</span><span class="n">_Base</span><span class="p">)</span> <span class="ow">or</span>
                <span class="n">callable</span><span class="p">(</span><span class="n">connectionstyle</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connector</span> <span class="o">=</span> <span class="n">connectionstyle</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connector</span> <span class="o">=</span> <span class="n">ConnectionStyle</span><span class="p">(</span><span class="n">connectionstyle</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_connectionstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the :class:`ConnectionStyle` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connector</span>

    <span class="k">def</span> <span class="nf">set_arrowstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the arrow style. Old attributes are forgotten. Without arguments</span>
<span class="sd">        (or with ``arrowstyle=None``) returns available box styles as a list of</span>
<span class="sd">        strings.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        arrowstyle : None, ArrowStyle, str, optional (default: None)</span>
<span class="sd">            Can be a string with arrowstyle name with optional comma-separated</span>
<span class="sd">            attributes, e.g.::</span>

<span class="sd">                set_arrowstyle(&quot;Fancy,head_length=0.2&quot;)</span>

<span class="sd">            Alternatively attributes can be provided as keywords, e.g.::</span>

<span class="sd">                set_arrowstyle(&quot;fancy&quot;, head_length=0.2)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">arrowstyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ArrowStyle</span><span class="o">.</span><span class="n">pprint_styles</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arrowstyle</span><span class="p">,</span> <span class="n">ArrowStyle</span><span class="o">.</span><span class="n">_Base</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_arrow_transmuter</span> <span class="o">=</span> <span class="n">arrowstyle</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_arrow_transmuter</span> <span class="o">=</span> <span class="n">ArrowStyle</span><span class="p">(</span><span class="n">arrowstyle</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_arrowstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the arrowstyle object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrow_transmuter</span>

    <span class="k">def</span> <span class="nf">set_mutation_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the mutation scale.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        scale : scalar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_mutation_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the mutation scale.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        scale : scalar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_scale</span>

    <span class="k">def</span> <span class="nf">set_mutation_aspect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aspect</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the aspect ratio of the bbox mutation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        aspect : scalar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_aspect</span> <span class="o">=</span> <span class="n">aspect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_mutation_aspect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the aspect ratio of the bbox mutation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_aspect</span>

    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the path of the arrow in the data coordinates. Use</span>
<span class="sd">        get_path_in_displaycoord() method to retrieve the arrow path</span>
<span class="sd">        in display coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_path</span><span class="p">,</span> <span class="n">fillable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path_in_displaycoord</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">cbook</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">fillable</span><span class="p">):</span>
            <span class="n">_path</span> <span class="o">=</span> <span class="n">concatenate_paths</span><span class="p">(</span><span class="n">_path</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform_path</span><span class="p">(</span><span class="n">_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_path_in_displaycoord</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the mutated path of the arrow in display coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dpi_cor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dpi_cor</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_posA_posB</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">posA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_posA_posB</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">posB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_posA_posB</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectionstyle</span><span class="p">()(</span><span class="n">posA</span><span class="p">,</span> <span class="n">posB</span><span class="p">,</span>
                                               <span class="n">patchA</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">patchA</span><span class="p">,</span>
                                               <span class="n">patchB</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">patchB</span><span class="p">,</span>
                                               <span class="n">shrinkA</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shrinkA</span> <span class="o">*</span> <span class="n">dpi_cor</span><span class="p">,</span>
                                               <span class="n">shrinkB</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shrinkB</span> <span class="o">*</span> <span class="n">dpi_cor</span>
                                               <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span><span class="o">.</span><span class="n">transform_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_original</span><span class="p">)</span>

        <span class="n">_path</span><span class="p">,</span> <span class="n">fillable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_arrowstyle</span><span class="p">()(</span>
            <span class="n">_path</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_mutation_scale</span><span class="p">()</span> <span class="o">*</span> <span class="n">dpi_cor</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_linewidth</span><span class="p">()</span> <span class="o">*</span> <span class="n">dpi_cor</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_mutation_aspect</span><span class="p">())</span>

        <span class="c1"># if not fillable:</span>
        <span class="c1">#    self._fill = False</span>

        <span class="k">return</span> <span class="n">_path</span><span class="p">,</span> <span class="n">fillable</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_visible</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="n">renderer</span><span class="o">.</span><span class="n">open_group</span><span class="p">(</span><span class="s1">&#39;patch&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_gid</span><span class="p">())</span>
        <span class="n">gc</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">new_gc</span><span class="p">()</span>

        <span class="n">gc</span><span class="o">.</span><span class="n">set_foreground</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_edgecolor</span><span class="p">,</span> <span class="n">isRGBA</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">lw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edgecolor</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lw</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">lw</span><span class="p">)</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">set_dashes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dashoffset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dashes</span><span class="p">)</span>

        <span class="n">gc</span><span class="o">.</span><span class="n">set_antialiased</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_antialiased</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_gc_clip</span><span class="p">(</span><span class="n">gc</span><span class="p">)</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">set_capstyle</span><span class="p">(</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">set_snap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_snap</span><span class="p">())</span>

        <span class="n">rgbFace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_facecolor</span>
        <span class="k">if</span> <span class="n">rgbFace</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rgbFace</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># (some?) renderers expect this as no-fill signal</span>

        <span class="n">gc</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span><span class="p">:</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">gc</span><span class="o">.</span><span class="n">set_hatch_color</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hatch_color</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="c1"># if we end up with a GC that does not have this method</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Your backend does not support setting the &quot;</span>
                                  <span class="s2">&quot;hatch color.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sketch_params</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">set_sketch_params</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sketch_params</span><span class="p">())</span>

        <span class="c1"># FIXME : dpi_cor is for the dpi-dependecy of the</span>
        <span class="c1"># linewidth. There could be room for improvement.</span>
        <span class="c1">#</span>
        <span class="c1"># dpi_cor = renderer.points_to_pixels(1.)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_dpi_cor</span><span class="p">(</span><span class="n">renderer</span><span class="o">.</span><span class="n">points_to_pixels</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
        <span class="n">path</span><span class="p">,</span> <span class="n">fillable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path_in_displaycoord</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cbook</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">fillable</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
            <span class="n">fillable</span> <span class="o">=</span> <span class="p">[</span><span class="n">fillable</span><span class="p">]</span>

        <span class="n">affine</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">IdentityTransform</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path_effects</span><span class="p">():</span>
            <span class="kn">from</span> <span class="nn">matplotlib.patheffects</span> <span class="k">import</span> <span class="n">PathEffectRenderer</span>
            <span class="n">renderer</span> <span class="o">=</span> <span class="n">PathEffectRenderer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_path_effects</span><span class="p">(),</span> <span class="n">renderer</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fillable</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">renderer</span><span class="o">.</span><span class="n">draw_path</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">affine</span><span class="p">,</span> <span class="n">rgbFace</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">renderer</span><span class="o">.</span><span class="n">draw_path</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">affine</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">gc</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
        <span class="n">renderer</span><span class="o">.</span><span class="n">close_group</span><span class="p">(</span><span class="s1">&#39;patch&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">class</span> <span class="nc">ConnectionPatch</span><span class="p">(</span><span class="n">FancyArrowPatch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A :class:`~matplotlib.patches.ConnectionPatch` class is to make</span>
<span class="sd">    connecting lines between two points (possibly in different axes).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;ConnectionPatch((</span><span class="si">%g</span><span class="s2">,</span><span class="si">%g</span><span class="s2">),(</span><span class="si">%g</span><span class="s2">,</span><span class="si">%g</span><span class="s2">))&quot;</span> <span class="o">%</span> \
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xy1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="nd">@docstring</span><span class="o">.</span><span class="n">dedent_interpd</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyA</span><span class="p">,</span> <span class="n">xyB</span><span class="p">,</span> <span class="n">coordsA</span><span class="p">,</span> <span class="n">coordsB</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">axesA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axesB</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                 <span class="n">arrow_transmuter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3&quot;</span><span class="p">,</span>
                 <span class="n">connector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">patchA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">patchB</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">shrinkA</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
                 <span class="n">shrinkB</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
                 <span class="n">mutation_scale</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span>
                 <span class="n">mutation_aspect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">dpi_cor</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect point *xyA* in *coordsA* with point *xyB* in *coordsB*</span>


<span class="sd">        Valid keys are</span>


<span class="sd">        ===============  ======================================================</span>
<span class="sd">        Key              Description</span>
<span class="sd">        ===============  ======================================================</span>
<span class="sd">        arrowstyle       the arrow style</span>
<span class="sd">        connectionstyle  the connection style</span>
<span class="sd">        relpos           default is (0.5, 0.5)</span>
<span class="sd">        patchA           default is bounding box of the text</span>
<span class="sd">        patchB           default is None</span>
<span class="sd">        shrinkA          default is 2 points</span>
<span class="sd">        shrinkB          default is 2 points</span>
<span class="sd">        mutation_scale   default is text size (in points)</span>
<span class="sd">        mutation_aspect  default is 1.</span>
<span class="sd">        ?                any key for :class:`matplotlib.patches.PathPatch`</span>
<span class="sd">        ===============  ======================================================</span>


<span class="sd">        *coordsA* and *coordsB* are strings that indicate the</span>
<span class="sd">        coordinates of *xyA* and *xyB*.</span>

<span class="sd">        =================   ===================================================</span>
<span class="sd">        Property            Description</span>
<span class="sd">        =================   ===================================================</span>
<span class="sd">        &#39;figure points&#39;     points from the lower left corner of the figure</span>
<span class="sd">        &#39;figure pixels&#39;     pixels from the lower left corner of the figure</span>
<span class="sd">        &#39;figure fraction&#39;   0,0 is lower left of figure and 1,1 is upper, right</span>
<span class="sd">        &#39;axes points&#39;       points from lower left corner of axes</span>
<span class="sd">        &#39;axes pixels&#39;       pixels from lower left corner of axes</span>
<span class="sd">        &#39;axes fraction&#39;     0,1 is lower left of axes and 1,1 is upper right</span>
<span class="sd">        &#39;data&#39;              use the coordinate system of the object being</span>
<span class="sd">                            annotated (default)</span>
<span class="sd">        &#39;offset points&#39;     Specify an offset (in points) from the *xy* value</span>

<span class="sd">        &#39;polar&#39;             you can specify *theta*, *r* for the annotation,</span>
<span class="sd">                            even in cartesian plots.  Note that if you</span>
<span class="sd">                            are using a polar axes, you do not need</span>
<span class="sd">                            to specify polar for the coordinate</span>
<span class="sd">                            system since that is the native &quot;data&quot; coordinate</span>
<span class="sd">                            system.</span>
<span class="sd">        =================   ===================================================</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">coordsB</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coordsB</span> <span class="o">=</span> <span class="n">coordsA</span>
        <span class="c1"># we&#39;ll draw ourself after the artist we annotate by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xy1</span> <span class="o">=</span> <span class="n">xyA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xy2</span> <span class="o">=</span> <span class="n">xyB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords1</span> <span class="o">=</span> <span class="n">coordsA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords2</span> <span class="o">=</span> <span class="n">coordsB</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axesA</span> <span class="o">=</span> <span class="n">axesA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axesB</span> <span class="o">=</span> <span class="n">axesB</span>

        <span class="n">FancyArrowPatch</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                 <span class="n">posA</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">posB</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                 <span class="n">arrowstyle</span><span class="o">=</span><span class="n">arrowstyle</span><span class="p">,</span>
                                 <span class="n">arrow_transmuter</span><span class="o">=</span><span class="n">arrow_transmuter</span><span class="p">,</span>
                                 <span class="n">connectionstyle</span><span class="o">=</span><span class="n">connectionstyle</span><span class="p">,</span>
                                 <span class="n">connector</span><span class="o">=</span><span class="n">connector</span><span class="p">,</span>
                                 <span class="n">patchA</span><span class="o">=</span><span class="n">patchA</span><span class="p">,</span>
                                 <span class="n">patchB</span><span class="o">=</span><span class="n">patchB</span><span class="p">,</span>
                                 <span class="n">shrinkA</span><span class="o">=</span><span class="n">shrinkA</span><span class="p">,</span>
                                 <span class="n">shrinkB</span><span class="o">=</span><span class="n">shrinkB</span><span class="p">,</span>
                                 <span class="n">mutation_scale</span><span class="o">=</span><span class="n">mutation_scale</span><span class="p">,</span>
                                 <span class="n">mutation_aspect</span><span class="o">=</span><span class="n">mutation_aspect</span><span class="p">,</span>
                                 <span class="n">clip_on</span><span class="o">=</span><span class="n">clip_on</span><span class="p">,</span>
                                 <span class="n">dpi_cor</span><span class="o">=</span><span class="n">dpi_cor</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># if True, draw annotation only if self.xy is inside the axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_annotation_clip</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        caculate the pixel position of given point</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span>

        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">transData</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_xunits</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_yunits</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">trans</span><span class="o">.</span><span class="n">transform_point</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;offset points&#39;</span><span class="p">:</span>
            <span class="c1"># convert the data point</span>
            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy</span>

            <span class="c1"># prevent recursion</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xycoords</span> <span class="o">==</span> <span class="s1">&#39;offset points&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_xy</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>

            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_xy</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xycoords</span><span class="p">)</span>

            <span class="c1"># convert the offset</span>
            <span class="n">dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_dpi</span><span class="p">()</span>
            <span class="n">x</span> <span class="o">*=</span> <span class="n">dpi</span> <span class="o">/</span> <span class="mf">72.</span>
            <span class="n">y</span> <span class="o">*=</span> <span class="n">dpi</span> <span class="o">/</span> <span class="mf">72.</span>

            <span class="c1"># add the offset to the data point</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">dx</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="n">dy</span>

            <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
        <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;polar&#39;</span><span class="p">:</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">transData</span>
            <span class="k">return</span> <span class="n">trans</span><span class="o">.</span><span class="n">transform_point</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;figure points&#39;</span><span class="p">:</span>
            <span class="c1"># points from the lower left corner of the figure</span>
            <span class="n">dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span>
            <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">w</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">h</span>

            <span class="n">x</span> <span class="o">*=</span> <span class="n">dpi</span> <span class="o">/</span> <span class="mf">72.</span>
            <span class="n">y</span> <span class="o">*=</span> <span class="n">dpi</span> <span class="o">/</span> <span class="mf">72.</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">x</span>
            <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">y</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
        <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;figure pixels&#39;</span><span class="p">:</span>
            <span class="c1"># pixels from the lower left corner of the figure</span>
            <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">w</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">h</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">x</span>
            <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">y</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
        <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;figure fraction&#39;</span><span class="p">:</span>
            <span class="c1"># (0,0) is lower left, (1,1) is upper right of figure</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">transFigure</span>
            <span class="k">return</span> <span class="n">trans</span><span class="o">.</span><span class="n">transform_point</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;axes points&#39;</span><span class="p">:</span>
            <span class="c1"># points from the lower left corner of the axes</span>
            <span class="n">dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span>
            <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">w</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">h</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">dpi</span> <span class="o">/</span> <span class="mf">72.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">dpi</span> <span class="o">/</span> <span class="mf">72.</span>
            <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">dpi</span> <span class="o">/</span> <span class="mf">72.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">dpi</span> <span class="o">/</span> <span class="mf">72.</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
        <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;axes pixels&#39;</span><span class="p">:</span>
            <span class="c1">#pixels from the lower left corner of the axes</span>

            <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">w</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">h</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">x</span>
            <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">y</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
        <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;axes fraction&#39;</span><span class="p">:</span>
            <span class="c1">#(0,0) is lower left, (1,1) is upper right of axes</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">transAxes</span>
            <span class="k">return</span> <span class="n">trans</span><span class="o">.</span><span class="n">transform_point</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set_annotation_clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set *annotation_clip* attribute.</span>

<span class="sd">          * True: the annotation will only be drawn when self.xy is inside the</span>
<span class="sd">                   axes.</span>
<span class="sd">          * False: the annotation will always be drawn regardless of its</span>
<span class="sd">                    position.</span>
<span class="sd">          * None: the self.xy will be checked only if *xycoords* is &quot;data&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_annotation_clip</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_annotation_clip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return *annotation_clip* attribute.</span>
<span class="sd">        See :meth:`set_annotation_clip` for the meaning of return values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_annotation_clip</span>

    <span class="k">def</span> <span class="nf">get_path_in_displaycoord</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the mutated path of the arrow in the display coord</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dpi_cor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dpi_cor</span><span class="p">()</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy1</span>
        <span class="n">posA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_xy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesA</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy2</span>
        <span class="n">posB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_xy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesB</span><span class="p">)</span>

        <span class="n">_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connectionstyle</span><span class="p">()(</span><span class="n">posA</span><span class="p">,</span> <span class="n">posB</span><span class="p">,</span>
                                           <span class="n">patchA</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">patchA</span><span class="p">,</span>
                                           <span class="n">patchB</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">patchB</span><span class="p">,</span>
                                           <span class="n">shrinkA</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shrinkA</span> <span class="o">*</span> <span class="n">dpi_cor</span><span class="p">,</span>
                                           <span class="n">shrinkB</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shrinkB</span> <span class="o">*</span> <span class="n">dpi_cor</span>
                                           <span class="p">)</span>

        <span class="n">_path</span><span class="p">,</span> <span class="n">fillable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_arrowstyle</span><span class="p">()(</span>
                                        <span class="n">_path</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">get_mutation_scale</span><span class="p">()</span> <span class="o">*</span> <span class="n">dpi_cor</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">get_linewidth</span><span class="p">()</span> <span class="o">*</span> <span class="n">dpi_cor</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">get_mutation_aspect</span><span class="p">()</span>
                                        <span class="p">)</span>

        <span class="k">return</span> <span class="n">_path</span><span class="p">,</span> <span class="n">fillable</span>

    <span class="k">def</span> <span class="nf">_check_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check if the annotation need to</span>
<span class="sd">        be drawn.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_annotation_clip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">b</span> <span class="ow">or</span> <span class="p">(</span><span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords1</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy1</span>
            <span class="n">xy_pixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_xy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesA</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">contains_point</span><span class="p">(</span><span class="n">xy_pixel</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">b</span> <span class="ow">or</span> <span class="p">(</span><span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords2</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy2</span>
            <span class="n">xy_pixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_xy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesB</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesB</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesB</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="o">.</span><span class="n">contains_point</span><span class="p">(</span><span class="n">xy_pixel</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">renderer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_renderer</span> <span class="o">=</span> <span class="n">renderer</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_visible</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_xy</span><span class="p">(</span><span class="n">renderer</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">FancyArrowPatch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Meteorographica</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>