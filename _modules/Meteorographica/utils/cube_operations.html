
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Meteorographica.utils.cube_operations &#8212; Meteorographica: python tools for making weather maps</title>
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Meteorographica</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/UK_spaghetti.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../pressure.html">Meteorographica.pressure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../wind.html">Meteorographica.wind</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../precipitation.html">Meteorographica.precipitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../observations.html">Meteorographica.observations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../background.html">Meteorographica.background</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/examples.html">Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../credits.html">Authors and acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../uses.html">Uses of this package</a></li>
</ul>
<h3><a href="https://github.com/philip-brohan/Meteorographica">Get the source code</a></h3>

<a href="https://github.com/philip-brohan/Meteorographica"
           rel="nofollow">Github source repository</a>

<h3>Found a bug, or have a suggestion?</h3>

Please <a href="https://github.com/philip-brohan/Meteorographica/issues/new">raise an issue</a>.
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for Meteorographica.utils.cube_operations</h1><div class="highlight"><pre>
<span></span><span class="c1"># (C) British Crown Copyright 2017, Met Office</span>
<span class="c1">#</span>
<span class="c1"># This code is free software: you can redistribute it and/or modify it under</span>
<span class="c1"># the terms of the GNU Lesser General Public License as published by the</span>
<span class="c1"># Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This code is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU Lesser General Public License for more details.</span>
<span class="c1">#</span>

<span class="c1"># Functions to process and manipulate iris cubes.</span>

<span class="kn">import</span> <span class="nn">copy</span>

<span class="c1"># Control the order of the vector dimensions of a cube, so the </span>
<span class="c1">#  numpy array of data has the expected shape.</span>
<div class="viewcode-block" id="cube_order_dimensions"><a class="viewcode-back" href="../../../oddments.html#Meteorographica.utils.cube_order_dimensions">[docs]</a><span class="k">def</span> <span class="nf">cube_order_dimensions</span><span class="p">(</span><span class="n">cube</span><span class="p">,</span><span class="n">dims_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reshape the data in an :class:`iris.cube.Cube` by re-ordering the dimensions.</span>

<span class="sd">    If the cube interface is not doing what I want, and I need to access the internal data array directly, then the exact shape of the array starts to matter, and a [latitude,longitude] array is not the same as a [longitude,latitude] one. This function sets the exact shape of the data array by specifying the order of the dimensions of the cube. Note that it does not modify the input cube, it returns a new one.</span>

<span class="sd">    Args:</span>
<span class="sd">        cube (:obj:`iris.cube.Cube`): The cube to have its data re-ordered.</span>
<span class="sd">        dims_list (:obj:`list` of :obj:`str`): Dimension names in desired order (e.g. &quot;(&#39;Latitude&#39;,&#39;Longitude&#39;,&#39;member&#39;)&quot;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        :obj:`iris.cube.Cube`: A new cube with the dimensions in the specified order.</span>

<span class="sd">    Raises:</span>
<span class="sd">        StandardError: Names in the dims_list do not match the names of the vector dimensions of the cube.</span>

<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span> 

    <span class="n">crds2</span><span class="o">=</span><span class="n">cube</span><span class="o">.</span><span class="n">coords</span><span class="p">()</span>
    <span class="n">crds</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">crds2</span><span class="p">)</span>
    <span class="c1"># Keep only the vector dimensions</span>
    <span class="k">for</span> <span class="n">crdi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">crds2</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crds2</span><span class="p">[</span><span class="n">crdi</span><span class="p">]</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">crds</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">crds2</span><span class="p">[</span><span class="n">crdi</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crds</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_list</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">StandardError</span><span class="p">(</span><span class="s2">&quot;Cube has </span><span class="si">%d</span><span class="s2"> vector dimensions and </span><span class="si">%d</span><span class="s2"> were specified&quot;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">crds</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_list</span><span class="p">)))</span>
    <span class="n">odr</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_list</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">dim_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dims_list</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">odr</span><span class="p">[</span><span class="n">dim_i</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">crds</span><span class="p">))</span> 
                      <span class="k">if</span> <span class="p">(</span><span class="n">crds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">long_name</span><span class="o">==</span><span class="n">dims_list</span><span class="p">[</span><span class="n">dim_i</span><span class="p">]</span> <span class="ow">or</span>
                          <span class="n">crds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">standard_name</span><span class="o">==</span><span class="n">dims_list</span><span class="p">[</span><span class="n">dim_i</span><span class="p">])][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">StandardError</span><span class="p">(</span><span class="s2">&quot;Cube does not have vector dimension </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                                 <span class="n">dims_list</span><span class="p">[</span><span class="n">dim_i</span><span class="p">])</span>
    <span class="n">result</span><span class="o">=</span><span class="n">cube</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">result</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">new_order</span><span class="o">=</span><span class="n">odr</span><span class="p">)</span></div>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Meteorographica</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>